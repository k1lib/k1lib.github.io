

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>k1lib.zircon &mdash; k1lib  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            k1lib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../base.html">Base module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli/index.html">k1lib.cli module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../callbacks/index.html">k1lib.callbacks module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../k1a.html">k1lib._k1a module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../k1ui.html">k1lib.k1ui module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../eqn.html">k1lib.eqn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fmt.html">k1lib.fmt module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphEqn.html">k1lib.graphEqn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../imports.html">k1lib.imports module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mo.html">k1lib.mo module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kast.html">k1lib.kast module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kcom.html">k1lib.kcom module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knn.html">k1lib.knn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kop.html">k1lib.kop module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kws.html">k1lib.kws module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../p5.html">k1lib.p5 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">k1lib.schedule module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../selector.html">k1lib.selector module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../selen.html">k1lib.selen module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../serpent.html">k1lib.serpent module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../serve.html">k1lib.serve module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../viz.html">k1lib.viz module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zircon.html">k1lib.zircon module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../monkey.html">Monkey patched classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelogs.html">Changelogs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">k1lib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">k1lib.zircon</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for k1lib.zircon</h1><div class="highlight"><pre>
<span></span><span class="c1"># AUTOGENERATED FILE! PLEASE DON&#39;T EDIT HERE. EDIT THE SOURCE NOTEBOOKS INSTEAD</span>
<span class="sd">&quot;&quot;&quot;Browser automation tool. This is kinda like selenium, but way more awesome.</span>

<span class="sd">How it works is that I&#39;ve developed a chrome extension that can communicate with</span>
<span class="sd">one of my servers, and functions here also communicate with it. After installing</span>
<span class="sd">the extension, you can open up a bunch of chrome windows, then using this module,</span>
<span class="sd">you can &quot;attach&quot; to a specific window. Then using methods provided here, you can</span>
<span class="sd">execute any random pieces of code as it you&#39;re in chrome&#39;s console.</span>

<span class="sd">This works already for some of my projects, but it takes too much time to document</span>
<span class="sd">everything, and I have so many other things to do, so if you&#39;re interested, ping</span>
<span class="sd">me at 157239q@gmail.com and I&#39;ll finalize this module. Some examples of what this</span>
<span class="sd">can do:</span>

<span class="sd">- https://mlexps.com/other/43-touhou/</span>
<span class="sd">- https://mlexps.com/other/44-gensokyo-days/</span>

<span class="sd">(yes, I&#39;m still addicted to touhou and it&#39;s slowly destroying my life)&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">k1lib</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">asyncio</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">html</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">k1lib.cli</span> <span class="k">as</span> <span class="nn">cli</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">k1lib.kws</span> <span class="k">as</span> <span class="nn">kws</span>
<span class="n">websockets</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">dep</span><span class="o">.</span><span class="n">websockets</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;newBrowser&quot;</span><span class="p">,</span> <span class="s2">&quot;Browser&quot;</span><span class="p">,</span> <span class="s2">&quot;Element&quot;</span><span class="p">,</span> <span class="s2">&quot;Locator&quot;</span><span class="p">,</span> <span class="s2">&quot;BrowserCancel&quot;</span><span class="p">,</span> <span class="s2">&quot;BrowserGroup&quot;</span><span class="p">]</span>
<span class="n">autoMsgIdx</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">AutoIncrement</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_Python_</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)</span>
<span class="n">_browserAutoIdx</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">AutoIncrement</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;_browser_&quot;</span><span class="p">);</span> <span class="n">_browserAnsD</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">();</span> <span class="n">_browserQueue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">bThread</span><span class="p">():</span> <span class="c1"># runs a thread that takes in requests to create new browsers, then spits it out # bThread</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">();</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>                <span class="c1"># bThread</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span> <span class="c1"># all future browser async interactions happens in this newly-created event loop, instead of the main loop of the notebooks # bThread</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                              <span class="c1"># bThread</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_browserQueue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>                <span class="c1"># bThread</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_browserQueue</span><span class="o">.</span><span class="n">popleft</span><span class="p">();</span> <span class="n">_browserAnsD</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">Browser</span><span class="p">()</span> <span class="c1"># bThread</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">inner</span><span class="p">())</span>                                             <span class="c1"># bThread</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bThread</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>                            <span class="c1"># bThread</span>
<span class="n">k1lib</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zircon&quot;</span><span class="p">,</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>                                    <span class="c1"># bThread</span>
                   <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;http_server&quot;</span><span class="p">,</span> <span class="s2">&quot;https://zircon.mlexps.com&quot;</span><span class="p">)</span>              <span class="c1"># bThread</span>
                   <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ws_server&quot;</span><span class="p">,</span> <span class="s2">&quot;wss://ws.zircon.mlexps.com&quot;</span><span class="p">),</span>              <span class="c1"># bThread</span>
    <span class="s2">&quot;from k1lib.zircon module&quot;</span><span class="p">);</span>                                                 <span class="c1"># bThread</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>                                                <span class="c1"># bThread</span>
<div class="viewcode-block" id="newBrowser">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.newBrowser">[docs]</a>
<span class="k">def</span> <span class="nf">newBrowser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="s2">&quot;Browser&quot;</span><span class="p">:</span>                                                   <span class="c1"># newBrowser</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a new browser&quot;&quot;&quot;</span>                                                  <span class="c1"># newBrowser</span>
    <span class="n">websockets</span><span class="o">.</span><span class="n">version</span> <span class="c1"># here to warn users if websockets is not installed       # newBrowser</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_browserAutoIdx</span><span class="p">();</span> <span class="n">_browserQueue</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>                      <span class="c1"># newBrowser</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_browserAnsD</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>                              <span class="c1"># newBrowser</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">_browserAnsD</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span> <span class="k">del</span> <span class="n">_browserAnsD</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span> <span class="k">return</span> <span class="n">ans</span>                   <span class="c1"># newBrowser</span></div>

<div class="viewcode-block" id="Browser">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser">[docs]</a>
<span class="k">class</span> <span class="nc">Browser</span><span class="p">:</span> <span class="c1"># controlling over selen.mlexps.com                               # Browser</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span> <span class="o">=</span> <span class="p">{};</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_ws_updated</span> <span class="o">=</span> <span class="kc">False</span>            <span class="c1"># Browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extId</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">clientId</span> <span class="o">=</span> <span class="kc">None</span>          <span class="c1"># Browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="p">[]</span>                             <span class="c1"># Browser</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handshake</span><span class="p">())</span>                                   <span class="c1"># Browser</span>
<div class="viewcode-block" id="Browser.close">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.close">[docs]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span> <span class="o">=</span> <span class="kc">True</span>                                      <span class="c1"># Browser</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_handshake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                  <span class="c1"># Browser</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">kws</span><span class="o">.</span><span class="n">WsClient</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k1lib</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">zircon</span><span class="o">.</span><span class="n">ws_server</span><span class="si">}</span><span class="s2">/handshake/client&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span> <span class="c1"># Browser</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                          <span class="c1"># Browser</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;connect&quot;</span><span class="p">}));</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="c1"># Browser</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;connect_res&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clientId</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;clientId&quot;</span><span class="p">];</span> <span class="k">break</span> <span class="c1"># Browser</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">()</span>                                                      <span class="c1"># Browser</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                      <span class="c1"># Browser</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">kws</span><span class="o">.</span><span class="n">WsClient</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k1lib</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">zircon</span><span class="o">.</span><span class="n">ws_server</span><span class="si">}</span><span class="s2">/connect/client/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">clientId</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span> <span class="c1"># Browser</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>                                                         <span class="c1"># Browser</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span><span class="p">:</span>                                           <span class="c1"># Browser</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>                                            <span class="c1"># Browser</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ext_ws_updated&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_ws_updated</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">continue</span> <span class="c1"># Browser</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">msg</span>                                     <span class="c1"># Browser</span>
<div class="viewcode-block" id="Browser.send">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.send">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;res&quot;</span><span class="p">:</span> <span class="c1"># always return if successful. If not successful then will throw an error instead! # Browser</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># connect guard                                      # Browser</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connecting to server...&quot;</span><span class="p">)</span>                                     <span class="c1"># Browser</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>                     <span class="c1"># Browser</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected&quot;</span><span class="p">)</span>                                                   <span class="c1"># Browser</span>
        <span class="n">msgIdx</span> <span class="o">=</span> <span class="n">autoMsgIdx</span><span class="p">();</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="n">msgIdx</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">});</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># Browser</span>
        <span class="k">while</span> <span class="n">msgIdx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">:</span>                                          <span class="c1"># Browser</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span> <span class="c1"># resends if return message is not found for quite a while. kws module should have handled # Browser</span>
            <span class="c1"># this correctly, but there might be a case where websockets module declares that the message has passed through, but # Browser</span>
            <span class="c1"># it hasn&#39;t actually passed through yet. Sounds improbable, but seems like it could happen in some of my tests # Browser</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="n">msgIdx</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">});</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># Browser</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">[</span><span class="n">msgIdx</span><span class="p">];</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">[</span><span class="n">msgIdx</span><span class="p">]</span>                         <span class="c1"># Browser</span>
        <span class="k">if</span> <span class="s2">&quot;success&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reason&quot;</span><span class="p">,</span> <span class="s2">&quot;Failure on Chrome extension, no reason logged&quot;</span><span class="p">))</span> <span class="c1"># Browser</span>
        <span class="k">if</span> <span class="s2">&quot;chromeRes&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span> <span class="k">return</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;chromeRes&quot;</span><span class="p">]</span>                           <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="n">msg</span>                                                               <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.scan">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.scan">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupPath</span><span class="p">:</span><span class="s2">&quot;str|list[str]&quot;</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                        <span class="c1"># Browser</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scans for all attached Extensions in the system.</span>
<span class="sd">Example::</span>

<span class="sd">    b = zircon.newBrowser()</span>
<span class="sd">    await b.scan()                    # grab metadata about every Extension that&#39;s ready</span>
<span class="sd">    await b.scan(&quot;touhou&quot;)            # grab metadata for Extensions in `touhou` group only</span>
<span class="sd">    await b.scan([&quot;touhou&quot;, &quot;mint2&quot;]) # grab metadata for Extensions in `touhou` or `mint2` groups</span>

<span class="sd">The result might look something like this:</span>

<span class="sd">.. code-block:: text</span>

<span class="sd">    {&#39;_ext_254175259_1701581542_5&#39;: {&#39;basics&#39;: {&#39;title&#39;: &#39;&#39;,</span>
<span class="sd">       &#39;url&#39;: &#39;https://zircon.mlexps.com/&#39;},</span>
<span class="sd">      &#39;tabInfo&#39;: {&#39;tabId&#39;: 872280718,</span>
<span class="sd">       &#39;data&#39;: {&#39;extId&#39;: &#39;_ext_254175259_1701581542_5&#39;, &#39;groupPath&#39;: &#39;touhou&#39;}},</span>
<span class="sd">      &#39;lastUpdated&#39;: 1701584077.7896328,</span>
<span class="sd">      &#39;lastPing&#39;: 1701587171.1521692},</span>
<span class="sd">     &#39;_ext_254175259_1701581542_11&#39;: {&#39;basics&#39;: {&#39;title&#39;: &#39;&#39;,</span>
<span class="sd">       &#39;url&#39;: &#39;https://zircon.mlexps.com/&#39;},</span>
<span class="sd">      &#39;tabInfo&#39;: {&#39;tabId&#39;: 872280722,</span>
<span class="sd">       &#39;data&#39;: {&#39;extId&#39;: &#39;_ext_254175259_1701581542_11&#39;, &#39;groupPath&#39;: &#39;touhou&#39;}},</span>
<span class="sd">      &#39;lastUpdated&#39;: 1701583562.7153254,</span>
<span class="sd">      &#39;lastPing&#39;: 1701587171.2784846}}</span>

<span class="sd">:param groupPath: (optional) If specified, only returns metadata for Extensions that</span>
<span class="sd">    have the specified group&quot;&quot;&quot;</span>                                                  <span class="c1"># Browser</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;scan&quot;</span><span class="p">}))[</span><span class="s2">&quot;exts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">filt</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tabInfo&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basics&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Browser</span>
        <span class="k">if</span> <span class="n">groupPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">res</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">toDict</span><span class="p">()</span>                          <span class="c1"># Browser</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupPath</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="n">res</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">filt</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">groupPath</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;tabInfo&quot;</span><span class="p">][</span><span class="s2">&quot;bgData&quot;</span><span class="p">][</span><span class="s2">&quot;config&quot;</span><span class="p">][</span><span class="s2">&quot;groupPaths&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">toDict</span><span class="p">()</span> <span class="c1"># Browser</span>
        <span class="k">else</span><span class="p">:</span>                                                                    <span class="c1"># Browser</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>                                                            <span class="c1"># Browser</span>
                <span class="n">gps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;tabInfo&quot;</span><span class="p">][</span><span class="s2">&quot;bgData&quot;</span><span class="p">][</span><span class="s2">&quot;config&quot;</span><span class="p">][</span><span class="s2">&quot;groupPaths&quot;</span><span class="p">])</span>        <span class="c1"># Browser</span>
                <span class="k">for</span> <span class="n">gp</span> <span class="ow">in</span> <span class="n">groupPath</span><span class="p">:</span>                                             <span class="c1"># Browser</span>
                    <span class="k">if</span> <span class="n">gp</span> <span class="ow">in</span> <span class="n">gps</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>                                    <span class="c1"># Browser</span>
            <span class="k">return</span> <span class="n">res</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">filt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">toDict</span><span class="p">()</span>                           <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.pickExt">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.pickExt">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">pickExt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extId</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">extId</span> <span class="o">=</span> <span class="n">extId</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;pickExt&quot;</span><span class="p">,</span> <span class="s2">&quot;extId&quot;</span><span class="p">:</span> <span class="n">extId</span><span class="p">});</span> <span class="k">return</span> <span class="s2">&quot;ok&quot;</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.pickExtFromGroup">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.pickExtFromGroup">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">pickExtFromGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupName</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>                             <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickExt</span><span class="p">((</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">groupName</span><span class="p">))</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.goto">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.goto">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>                                       <span class="c1"># Browser</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Typical times for this to be waiting for page change confirmation:</span>

<span class="sd">- https://en.touhouwiki.net/wiki/Touhou_Wiki: 4.42s</span>
<span class="sd">- https://www.google.com: 5s</span>
<span class="sd">- https://mlexps.com: 5.2s</span>
<span class="sd">- https://www.amazon.com: 6.2s</span>
<span class="sd">- https://www.youtube.com: 9.4s</span>

<span class="sd">Quite a distribution. So I figure 15s would be a reasonable middle ground</span>

<span class="sd">:param url: url to navigate the page to</span>
<span class="sd">:param timeout: will hang until received confirmation that the extension has been</span>
<span class="sd">    loaded on the new page. If has not received anything after this many seconds,</span>
<span class="sd">    will return regardless&quot;&quot;&quot;</span>                                                    <span class="c1"># Browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ext_ws_updated</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">})</span> <span class="c1"># Browser</span>
        <span class="c1"># wait until page has reloaded, and extension reconnected, or 10s has passed # Browser</span>
        <span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>                                                  <span class="c1"># Browser</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext_ws_updated</span><span class="p">:</span>                                          <span class="c1"># Browser</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>                                             <span class="c1"># Browser</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2">s up, breaking...&quot;</span><span class="p">);</span> <span class="k">break</span> <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="n">res</span>                                                               <span class="c1"># Browser</span></div>

    <span class="k">def</span> <span class="nf">_addE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Element&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;localElems&quot;</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">]},</span> <span class="n">d</span><span class="p">)</span> <span class="c1"># Browser</span>
    <span class="c1"># return e #self.elements.append(e); return e # was experimenting with notifying elements they&#39;re now invalid # Browser</span>
<div class="viewcode-block" id="Browser.querySelector">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.querySelector">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">querySelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Element&quot;</span><span class="p">:</span>                    <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;querySelector&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="n">selector</span><span class="p">}))</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.querySelectorAll">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.querySelectorAll">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">querySelectorAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;list[Element]&quot;</span><span class="p">:</span>           <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;querySelectorAll&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="n">selector</span><span class="p">})]</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.window">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.window">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Element&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;window&quot;</span><span class="p">}))</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.document">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.document">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">document</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Element&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;document&quot;</span><span class="p">}));</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.locate">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.locate">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">locate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;list[Element]&quot;</span><span class="p">:</span>                            <span class="c1"># Browser</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Locates text somewhere and returns plausible Elements&quot;&quot;&quot;</span>              <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;locate&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">})</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;body&quot;</span><span class="p">]</span> <span class="c1"># Browser</span></div>

<div class="viewcode-block" id="Browser.locate2">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.locate2">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">locate2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locator</span><span class="p">:</span><span class="s2">&quot;Locator&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>     <span class="c1"># Browser</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;locate2&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;locator&quot;</span><span class="p">:</span> <span class="n">locator</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="n">depth</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">}))</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="c1"># Browser</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_pageInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                   <span class="c1"># Browser</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span>                               <span class="c1"># Browser</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                              <span class="c1"># Browser</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">())[</span><span class="bp">self</span><span class="o">.</span><span class="n">extId</span><span class="p">]</span>                    <span class="c1"># Browser</span>
            <span class="k">if</span> <span class="s2">&quot;basics&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span> <span class="ow">and</span> <span class="s2">&quot;url&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span><span class="p">[</span><span class="s2">&quot;basics&quot;</span><span class="p">]:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pageInfo</span> <span class="c1"># Browser</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>                                                  <span class="c1"># Browser</span>
<div class="viewcode-block" id="Browser.scrollDown">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Browser.scrollDown">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">scrollDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>                 <span class="c1"># Browser</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrolls &lt;step&gt; pixels down continuously every &lt;sleep&gt; seconds, until can&#39;t, or time exceeds &lt;timeout&gt;&quot;&quot;&quot;</span> <span class="c1"># Browser</span>
        <span class="n">window</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">();</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>                    <span class="c1"># Browser</span>
        <span class="n">newY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>                                                     <span class="c1"># Browser</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>                                 <span class="c1"># Browser</span>
            <span class="k">await</span> <span class="n">window</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="s2">&quot;scrollBy&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">]);</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span> <span class="c1"># Browser</span>
            <span class="n">oldY</span> <span class="o">=</span> <span class="n">newY</span><span class="p">;</span> <span class="n">newY</span> <span class="o">=</span> <span class="k">await</span> <span class="n">window</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;scrollY&quot;</span><span class="p">)</span>                    <span class="c1"># Browser</span>
            <span class="k">if</span> <span class="n">newY</span> <span class="o">&lt;=</span> <span class="n">oldY</span><span class="p">:</span> <span class="k">break</span>                                               <span class="c1"># Browser</span></div>

    <span class="k">def</span> <span class="nf">_toLinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span> <span class="k">return</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">querySelector</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">toLinks</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1"># Browser</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Browser extId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">extId</span><span class="si">}</span><span class="s2">&gt;&quot;</span>                   <span class="c1"># Browser</span></div>

<span class="n">inf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>                                                               <span class="c1"># Browser</span>
<div class="viewcode-block" id="Element">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element">[docs]</a>
<span class="k">class</span> <span class="nc">Element</span><span class="p">:</span>                                                                   <span class="c1"># Element</span>
<div class="viewcode-block" id="Element.__init__">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">browser</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">extras</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represents a specific element in the current browser</span>

<span class="sd">:param extras: extra metadata, for nice displaying&quot;&quot;&quot;</span>                            <span class="c1"># Element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">browser</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span>   <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.value">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.value">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="c1"># like elem.value(&quot;.innerHTML&quot;), or &quot;.style.backgroundColor&quot; # Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the value of some property of the current element.</span>
<span class="sd">Example::</span>

<span class="sd">    browser = ...</span>
<span class="sd">    # returns value of `document.querySelector(&quot;body&quot;).innerHTML`</span>
<span class="sd">    await browser.querySelector(&quot;body&quot;).value(&quot;.innerHTML&quot;)</span>
<span class="sd">    # returns value of `document.querySelector(&quot;h1&quot;).style.color`</span>
<span class="sd">    await browser.querySelector(&quot;h1&quot;).value(&quot;.style.color&quot;)</span>

<span class="sd">:param chain: resolving chain to the property&quot;&quot;&quot;</span>                                 <span class="c1"># Element</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">];</span> <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_value&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;chain&quot;</span><span class="p">:</span> <span class="n">chain</span><span class="p">})</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.setValue">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.setValue">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">setValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>                                  <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets value of element&#39;s properties</span>

<span class="sd">See also: :meth:`value`</span>

<span class="sd">:param chain: resolving chain to the property</span>
<span class="sd">:param value: anything json-dumpable&quot;&quot;&quot;</span>                                          <span class="c1"># Element</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">];</span> <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_setValue&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;chain&quot;</span><span class="p">:</span> <span class="n">chain</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.func">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.func">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                  <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes any function on this element.</span>
<span class="sd">Example::</span>

<span class="sd">    browser = ...</span>
<span class="sd">    await browser.querySelector(&quot;#someBtn&quot;).func(&quot;.click&quot;)</span>

<span class="sd">:param chain: resolving chain to the function</span>
<span class="sd">:param args: tuple of json-dumpable objects&quot;&quot;&quot;</span>                                   <span class="c1"># Element</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">]</span>                               <span class="c1"># Element</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_func&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;chain&quot;</span><span class="p">:</span> <span class="n">chain</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)})</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.inputText">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.inputText">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">inputText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>                                    <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Input text to this element (assuming input box/text area). You&#39;d think</span>
<span class="sd">that this is pretty simple, but it&#39;s surprisingly very, very complicated. Tons</span>
<span class="sd">of people doing tons of different things, with lots of frontend frameworks. That</span>
<span class="sd">means that there is no single mode that just works everywhere, so that&#39;s where</span>
<span class="sd">the &quot;mode&quot; param comes in. Currently, zircon provides these:</span>

<span class="sd">- 0: sets &quot;.value&quot; of the element</span>
<span class="sd">- 1: send KeyboardEvent events to the element, typing each character out</span>
<span class="sd">- 2: use document.execCommand(&quot;insertText&quot;), works on facebook/instagram</span>

<span class="sd">:param value: the text value to input</span>
<span class="sd">:param mode: explained above&quot;&quot;&quot;</span>                                                  <span class="c1"># Element</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_inputText&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">})</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.parent">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.parent">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                      <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Grabs the direct parent of this element. Short, sweet and simple&quot;&quot;&quot;</span>   <span class="c1"># Element</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_parent&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">}))</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.parentC">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.parentC">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">parentC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minHeight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">deltaX</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">deltaY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxTries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">takeAfter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Grabs a nested parent element of this element that meets the specified conditions.</span>
<span class="sd">&quot;parentC&quot; can be thought of as &quot;complex parent&quot;. Example::</span>

<span class="sd">    await e.parent() # most straightforwardly, gets the immediate parent</span>
<span class="sd">    await e.parentC(minWidth=600, takeAfter=False)</span>

<span class="sd">The second line requires some explaining. Let&#39;s say that there&#39;re these elements: A -&gt; B -&gt; C -&gt; D -&gt; E</span>
<span class="sd">Assume E is the current element. Then the second line will recursively grabs parent elements, check if</span>
<span class="sd">it&#39;s width is at least that width (in this case, say &quot;B&quot;), then returns the element B if takeAfter is True,</span>
<span class="sd">else it returns element C.</span>

<span class="sd">There&#39;re more selectors:</span>
<span class="sd">- minWidth: grab parent that&#39;s at least this wide</span>
<span class="sd">- minHeight: same with minWidth</span>
<span class="sd">- deltaY: if positive, grab parent that has y&#39; &gt; y + deltaY (y is the current element&#39;s y). If</span>
<span class="sd">negative, grab parent that has y&#39; &lt; y + deltaY</span>
<span class="sd">- deltaX: same with deltaY</span>

<span class="sd">These together with :meth:`childrenC` should help you to navigate around locally.</span>

<span class="sd">:param minWidth: if specified, finds smallest parent that is bigger than this</span>
<span class="sd">:param maxTries: the number of consecutive parents to try out if minWidth or minHeight is specified</span>
<span class="sd">:param takeAfter: if True, take the parent bigger than the constraints, else take the parent just shy of that&quot;&quot;&quot;</span> <span class="c1"># Element</span>
        <span class="n">prevE</span> <span class="o">=</span> <span class="bp">self</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">();</span> <span class="n">ogX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">];</span> <span class="n">ogY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="c1"># Element</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxTries</span><span class="p">):</span>                                                <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">minWidth</span> <span class="ow">and</span> <span class="p">(</span><span class="k">await</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;clientWidth&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">minWidth</span><span class="p">:</span> <span class="k">break</span>     <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">minHeight</span> <span class="ow">and</span> <span class="p">(</span><span class="k">await</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;clientHeight&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">minHeight</span><span class="p">:</span> <span class="k">break</span>  <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">deltaX</span><span class="p">:</span>                                                           <span class="c1"># Element</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>                                      <span class="c1"># Element</span>
                <span class="k">if</span> <span class="n">deltaX</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                                                   <span class="c1"># Element</span>
                    <span class="k">if</span> <span class="n">ogX</span> <span class="o">+</span> <span class="n">deltaX</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span> <span class="k">break</span>                                   <span class="c1"># Element</span>
                <span class="k">else</span><span class="p">:</span>                                                            <span class="c1"># Element</span>
                    <span class="k">if</span> <span class="n">ogX</span> <span class="o">+</span> <span class="n">deltaX</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span> <span class="k">break</span>                                   <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">deltaY</span><span class="p">:</span>                                                           <span class="c1"># Element</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>                                      <span class="c1"># Element</span>
                <span class="k">if</span> <span class="n">deltaY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                                                   <span class="c1"># Element</span>
                    <span class="k">if</span> <span class="n">ogY</span> <span class="o">+</span> <span class="n">deltaY</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span> <span class="k">break</span>                                   <span class="c1"># Element</span>
                <span class="k">else</span><span class="p">:</span>                                                            <span class="c1"># Element</span>
                    <span class="k">if</span> <span class="n">ogY</span> <span class="o">+</span> <span class="n">deltaY</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span> <span class="k">break</span>                                   <span class="c1"># Element</span>
            <span class="n">prevE</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="k">await</span> <span class="n">e</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>                                      <span class="c1"># Element</span>
        <span class="k">return</span> <span class="n">e</span> <span class="k">if</span> <span class="n">takeAfter</span> <span class="k">else</span> <span class="n">prevE</span>                                         <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.children">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.children">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;List[Element]&quot;</span><span class="p">:</span>                                 <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Grabs all direct children of this element.&quot;&quot;&quot;</span>                         <span class="c1"># Element</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_children&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">})]</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.childrenC">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.childrenC">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">childrenC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minHeight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxWidth</span><span class="o">=</span><span class="n">inf</span><span class="p">,</span> <span class="n">maxHeight</span><span class="o">=</span><span class="n">inf</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;List[Element]&quot;</span><span class="p">:</span> <span class="c1"># Element</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursively grabs all children, and returns all elements that&#39;s within the specified bounds.</span>
<span class="sd">Note that if A is the parent of B, and both meets the conditions, then only A is returned.&quot;&quot;&quot;</span> <span class="c1"># Element</span>
        <span class="n">chs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">();</span> <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>                                    <span class="c1"># Element</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chs</span><span class="p">:</span>                                                           <span class="c1"># Element</span>
            <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ch</span><span class="o">.</span><span class="n">extras</span><span class="p">:</span> <span class="k">continue</span>                               <span class="c1"># Element</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">];</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">];</span> <span class="n">h</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span>                      <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">minWidth</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">minHeight</span><span class="p">:</span> <span class="k">continue</span>                           <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;=</span> <span class="n">maxWidth</span> <span class="ow">and</span> <span class="n">h</span> <span class="o">&lt;=</span> <span class="n">maxHeight</span><span class="p">:</span> <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>                  <span class="c1"># Element</span>
            <span class="k">else</span><span class="p">:</span>                                                                <span class="c1"># Element</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="k">await</span> <span class="n">ch</span><span class="o">.</span><span class="n">childrenC</span><span class="p">(</span><span class="n">minWidth</span><span class="p">,</span> <span class="n">minHeight</span><span class="p">,</span> <span class="n">maxWidth</span><span class="p">,</span> <span class="n">maxHeight</span><span class="p">):</span> <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="c1"># Element</span>
        <span class="k">return</span> <span class="n">ans</span>                                                               <span class="c1"># Element</span></div>

    <span class="k">def</span> <span class="nf">_addE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>                             <span class="c1"># Element</span>
<div class="viewcode-block" id="Element.querySelector">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.querySelector">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">querySelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Element&quot;</span><span class="p">:</span>                    <span class="c1"># Element</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_querySelector&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;querySelector&quot;</span><span class="p">:</span> <span class="n">selector</span><span class="p">}))</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.querySelectorAll">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.querySelectorAll">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">querySelectorAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;list[Element]&quot;</span><span class="p">:</span>           <span class="c1"># Element</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;elem_querySelectorAll&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;querySelector&quot;</span><span class="p">:</span> <span class="n">selector</span><span class="p">})]</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.snake">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.snake">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">snake</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="c1"># get uniquely identifying css selector (? not sure, long time ago) # Element</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;snake&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">})</span> <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.locate">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.locate">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">locate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;list[Element]&quot;</span><span class="p">:</span>                            <span class="c1"># Element</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;locate&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">})]</span> <span class="c1"># Element</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>                                                            <span class="c1"># Element</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]:</span> <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>                              <span class="c1"># Element</span>
            <span class="k">elif</span> <span class="n">s</span> <span class="ow">in</span> <span class="k">await</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;textContent&quot;</span><span class="p">):</span> <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>                <span class="c1"># Element</span>
        <span class="k">return</span> <span class="n">ans</span>                                                               <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Element.locate2">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Element.locate2">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">locate2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locator</span><span class="p">:</span><span class="s2">&quot;Locator&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>             <span class="c1"># Element</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_addE</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;locate2&quot;</span><span class="p">,</span> <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;locator&quot;</span><span class="p">:</span> <span class="n">locator</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="n">depth</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">}))</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="c1"># Element</span></div>

    <span class="k">def</span> <span class="nf">_toLinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>                                                       <span class="c1"># Element</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">_pageInfo</span><span class="p">())[</span><span class="s2">&quot;basics&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">];</span> <span class="n">htm</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;innerHTML&quot;</span><span class="p">))</span> <span class="c1"># Element</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">);</span> <span class="n">baseUrl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">netloc</span><span class="si">}</span><span class="s2">&quot;</span>                  <span class="c1"># Element</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">htm</span><span class="p">]</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">toLinks</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">baseUrl</span><span class="si">}{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>\
            <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">aS</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">aS</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="c1"># Element</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Element</span>
        <span class="k">try</span><span class="p">:</span>                                                                     <span class="c1"># Element</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Element selector=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="si">}</span><span class="s2">&#39; browser=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">extId</span><span class="si">}</span><span class="s2">/&gt;&quot;</span> <span class="c1"># Element</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;localElems&quot;</span><span class="p">:</span>                          <span class="c1"># Element</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">;</span>                                                 <span class="c1"># Element</span>
                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;Element </span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> id=&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot; #child=</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nChildren&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> class=&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;className&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot; %parent=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;boundedCoords&#39;</span><span class="p">][</span><span class="s1">&#39;areaRatio&#39;</span><span class="p">][</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">% %screen=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;boundedCoords&#39;</span><span class="p">][</span><span class="s1">&#39;areaRatio&#39;</span><span class="p">][</span><span class="s1">&#39;screen&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">% /&gt;&quot;&quot;&quot;</span> <span class="c1"># Element</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;Element </span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> id=&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot; #child=</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nChildren&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> class=&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;className&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot; /&gt;&quot;&quot;&quot;</span> <span class="c1"># Element</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>                                                             <span class="c1"># Element</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Element browser=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">extId</span><span class="si">}</span><span class="s2">/&gt;&quot;</span>                        <span class="c1"># Element</span>
    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                       <span class="c1"># Element</span>
        <span class="k">try</span><span class="p">:</span>                                                                     <span class="c1"># Element</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">;</span> <span class="n">im</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>                                             <span class="c1"># Element</span>
            <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>                                                    <span class="c1"># Element</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mi">400</span><span class="o">/</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">];</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">p5</span><span class="p">;</span> <span class="n">p5</span><span class="o">.</span><span class="n">newSketch</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># Element</span>
                <span class="n">p5</span><span class="o">.</span><span class="n">stroke</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span> <span class="n">p5</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="c1"># Element</span>
                <span class="n">p5</span><span class="o">.</span><span class="n">stroke</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">p5</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="c1"># Element</span>
                <span class="n">p5</span><span class="o">.</span><span class="n">stroke</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">p5</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;boundedCoords&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="c1"># Element</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">p5</span><span class="o">.</span><span class="n">img</span><span class="p">()</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">toHtml</span><span class="p">();</span> <span class="n">im</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Location on screen (blue - window, green - parent, red - element):&lt;br&gt;</span><span class="si">{</span><span class="n">im</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Element</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">strip</span><span class="p">()]))</span> <span class="c1"># Element</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;pre&gt;</span><span class="si">{</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span><span class="si">}</span><span class="s2">&lt;/pre&gt;</span><span class="si">{</span><span class="n">im</span><span class="si">}</span><span class="s2">&lt;br&gt;Text content:&lt;pre style=&#39;padding: 10px&#39;&gt;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&lt;/pre&gt;&quot;&quot;&quot;</span> <span class="c1"># Element</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>                                                             <span class="c1"># Element</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span>                                      <span class="c1"># Element</span></div>

<div class="viewcode-block" id="Locator">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Locator">[docs]</a>
<span class="k">class</span> <span class="nc">Locator</span><span class="p">:</span>                                                                   <span class="c1"># Locator</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">topleft</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">bottomright</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">klass</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">nChildren</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>                                                         <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span> <span class="o">=</span> <span class="n">topleft</span>                                                   <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottomright</span> <span class="o">=</span> <span class="n">bottomright</span>                                           <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>                                                         <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>                                                           <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">klass</span>                                                       <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nChildren</span> <span class="o">=</span> <span class="n">nChildren</span>                                               <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>                                                       <span class="c1"># Locator</span>
<div class="viewcode-block" id="Locator.addChild">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Locator.addChild">[docs]</a>
    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span><span class="s2">&quot;Locator&quot;</span><span class="p">):</span>                                         <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>                                              <span class="c1"># Locator</span></div>

<div class="viewcode-block" id="Locator.json">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Locator.json">[docs]</a>
    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;topleft&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span><span class="p">,</span> <span class="s2">&quot;bottomright&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomright</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;klass&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">klass</span><span class="p">,</span> <span class="s2">&quot;nChildren&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nChildren</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]}</span> <span class="c1"># Locator</span></div>

<div class="viewcode-block" id="Locator.fromJson">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Locator.fromJson">[docs]</a>
    <span class="nd">@staticmethod</span>                                                                <span class="c1"># Locator</span>
    <span class="k">def</span> <span class="nf">fromJson</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>                                                             <span class="c1"># Locator</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">];</span> <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">];</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">Locator</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>          <span class="c1"># Locator</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span> <span class="n">loc</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">Locator</span><span class="o">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>                     <span class="c1"># Locator</span>
        <span class="k">return</span> <span class="n">loc</span>                                                               <span class="c1"># Locator</span></div>

<div class="viewcode-block" id="Locator.builder">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Locator.builder">[docs]</a>
    <span class="nd">@staticmethod</span>                                                                <span class="c1"># Locator</span>
    <span class="k">def</span> <span class="nf">builder</span><span class="p">():</span>                                                               <span class="c1"># Locator</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span> <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What&#39;s the name of this Locator? &quot;</span><span class="p">)</span>         <span class="c1"># Locator</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">batched</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">pretty</span><span class="p">()</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">));</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Where is it roughly on the screen/relative to its parent?&quot;</span><span class="p">);</span> <span class="n">topleft</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Top left: &quot;</span><span class="p">);</span> <span class="n">bottomright</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Bottom right: &quot;</span><span class="p">)</span> <span class="c1"># Locator</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span> <span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Does it contain any text? &quot;</span><span class="p">)</span>                <span class="c1"># Locator</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span> <span class="n">tag</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What html tag is it? &quot;</span><span class="p">)</span>                      <span class="c1"># Locator</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span> <span class="n">klass</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Does it have any class names? &quot;</span><span class="p">)</span>           <span class="c1"># Locator</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span> <span class="n">nChildren</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;How many children does it expect to have? 0-100: &quot;</span><span class="p">)</span> <span class="c1"># Locator</span>
        <span class="k">return</span> <span class="n">Locator</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">topleft</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottomright</span><span class="p">),</span> <span class="n">text</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">nChildren</span><span class="p">)</span> <span class="c1"># Locator</span></div>

    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">px1</span><span class="p">,</span><span class="n">py1</span><span class="p">,</span><span class="n">px2</span><span class="p">,</span><span class="n">py2</span><span class="p">):</span>                                             <span class="c1"># Locator</span>
        <span class="n">p5</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">p5</span><span class="p">;</span> <span class="n">topleft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topleft</span><span class="p">;</span> <span class="n">bottomright</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomright</span>    <span class="c1"># Locator</span>
        <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">topleft</span><span class="o">//</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span> <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">bottomright</span><span class="o">//</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span>                  <span class="c1"># Locator</span>
        <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">topleft</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span> <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">bottomright</span><span class="o">%</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span>                    <span class="c1"># Locator</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">left</span><span class="p">)</span><span class="o">*</span><span class="n">px1</span> <span class="o">+</span> <span class="n">left</span><span class="o">*</span><span class="n">px2</span><span class="p">;</span> <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">right</span><span class="p">)</span> <span class="o">*</span><span class="n">px1</span> <span class="o">+</span> <span class="n">right</span> <span class="o">*</span><span class="n">px2</span>           <span class="c1"># Locator</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">top</span><span class="p">)</span> <span class="o">*</span><span class="n">py1</span> <span class="o">+</span> <span class="n">top</span> <span class="o">*</span><span class="n">py2</span><span class="p">;</span> <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bottom</span><span class="p">)</span><span class="o">*</span><span class="n">py1</span> <span class="o">+</span> <span class="n">bottom</span><span class="o">*</span><span class="n">py2</span>           <span class="c1"># Locator</span>
        <span class="n">p5</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">,</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">);</span> <span class="n">p5</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="o">+</span><span class="n">x2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y2</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>          <span class="c1"># Locator</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">_plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>                             <span class="c1"># Locator</span>
<div class="viewcode-block" id="Locator.plot">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.Locator.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                              <span class="c1"># Locator</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="mi">1920</span><span class="o">*</span><span class="mi">1080</span><span class="p">;</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">p5</span>                                  <span class="c1"># Locator</span>
        <span class="n">p5</span><span class="o">.</span><span class="n">newSketch</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span> <span class="n">p5</span><span class="o">.</span><span class="n">background</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>                            <span class="c1"># Locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span> <span class="k">return</span> <span class="n">p5</span><span class="o">.</span><span class="n">img</span><span class="p">()</span>                                  <span class="c1"># Locator</span></div>
</div>

<span class="n">k1lib</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">zircon</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;conflictDuration&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;How many seconds does the Extensions need to not take orders from other Python clients before our Python clients can take over? If too high, there won&#39;t be any free Extensions left, and if too low, there will be interference with other ppl&quot;</span><span class="p">)</span> <span class="c1"># Locator</span>
<div class="viewcode-block" id="BrowserCancel">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.BrowserCancel">[docs]</a>
<span class="k">class</span> <span class="nc">BrowserCancel</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>                                             <span class="c1"># BrowserCancel</span></div>

<div class="viewcode-block" id="BrowserGroup">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.BrowserGroup">[docs]</a>
<span class="k">class</span> <span class="nc">BrowserGroup</span><span class="p">:</span>                                                              <span class="c1"># BrowserGroup</span>
<div class="viewcode-block" id="BrowserGroup.__init__">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.BrowserGroup.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupPath</span><span class="p">:</span><span class="s2">&quot;str|list[str]&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>                  <span class="c1"># BrowserGroup</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs a browser group.</span>

<span class="sd">:param groupPath: what group of browsers do you want to take control over?</span>
<span class="sd">:param limit: only take over this many browsers&quot;&quot;&quot;</span>                               <span class="c1"># BrowserGroup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupPath</span> <span class="o">=</span> <span class="n">groupPath</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>                           <span class="c1"># BrowserGroup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scanBrowser</span> <span class="o">=</span> <span class="n">newBrowser</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extIds</span> <span class="o">=</span> <span class="p">[];</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browsers</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># BrowserGroup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setupFinished</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">())</span>          <span class="c1"># BrowserGroup</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                      <span class="c1"># BrowserGroup</span>
        <span class="k">with</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">captureStdout</span><span class="p">():</span> <span class="n">scan</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scanBrowser</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupPath</span><span class="p">)</span> <span class="c1"># BrowserGroup</span>
        <span class="n">extIds</span> <span class="o">=</span> <span class="n">scan</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">filt</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;lastUpdated&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">zircon</span><span class="o">.</span><span class="n">conflictDuration</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">deref</span><span class="p">()</span> <span class="c1"># BrowserGroup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extIds</span> <span class="o">=</span> <span class="n">extIds</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span> <span class="o">|</span> <span class="n">cli</span><span class="o">.</span><span class="n">deref</span><span class="p">()</span>               <span class="c1"># BrowserGroup</span>
        <span class="c1"># then have all the browsers pick the exts                               # BrowserGroup</span>
        <span class="k">for</span> <span class="n">extId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extIds</span><span class="p">:</span>                                               <span class="c1"># BrowserGroup</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">newBrowser</span><span class="p">()</span>                                                     <span class="c1"># BrowserGroup</span>
            <span class="k">with</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">captureStdout</span><span class="p">():</span> <span class="k">await</span> <span class="n">b</span><span class="o">.</span><span class="n">pickExt</span><span class="p">(</span><span class="n">extId</span><span class="p">)</span>                   <span class="c1"># BrowserGroup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_browsers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>                                             <span class="c1"># BrowserGroup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setupFinished</span> <span class="o">=</span> <span class="kc">True</span>                                               <span class="c1"># BrowserGroup</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_setupGuard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                 <span class="c1"># BrowserGroup</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setupFinished</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>                 <span class="c1"># BrowserGroup</span>
<div class="viewcode-block" id="BrowserGroup.execute">
<a class="viewcode-back" href="../../zircon.html#k1lib.zircon.BrowserGroup.execute">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aFn</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>                                    <span class="c1"># BrowserGroup</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the specified async function repeatedly whenever a browser frees up.</span>
<span class="sd">Example::</span>

<span class="sd">    linksToVisit = deque([</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Reimu_Hakurei&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Marisa_Kirisame&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Touhou_Project&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Imperishable_Night&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Perfect_Cherry_Blossom&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Embodiment_of_Scarlet_Devil&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Subterranean_Animism&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Mountain_of_Faith&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Phantasmagoria_of_Flower_View&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Hakurei_Shrine&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Touhou_Wiki:Projects&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Yukari_Yakumo&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Undefined_Fantastic_Object&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Aya_Shameimaru&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Sakuya_Izayoi&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Immaterial_and_Missing_Power&#39;,</span>
<span class="sd">        &#39;https://en.touhouwiki.net/wiki/Sanae_Kochiya&#39;</span>
<span class="sd">    ])</span>
<span class="sd">    data = []</span>

<span class="sd">    async def crawl(b:&quot;zircon.Browser&quot;):</span>
<span class="sd">        # put here because it seems to resolve lots of problems that I have</span>
<span class="sd">        # when browser instances are scheduled too close together</span>
<span class="sd">        await asyncio.sleep(1)</span>

<span class="sd">        # if it seems like there&#39;re no more data to process, then throw zircon.BrowserCancel().</span>
<span class="sd">        # The current browser will never be scheduled while executing this function again</span>
<span class="sd">        if len(linksToVisit) == 0: raise zircon.BrowserCancel()</span>


<span class="sd">        url = linksToVisit.popleft()</span>
<span class="sd">        try: # do your normal web crawling stuff here</span>
<span class="sd">            await b.goto(url)</span>
<span class="sd">            title = await (await b.querySelector(&quot;title&quot;)).value(&quot;innerHTML&quot;)</span>

<span class="sd">            # save data somewhere</span>
<span class="sd">            data.append([url, title])</span>
<span class="sd">        except: linksToVisit.append(url) # try again later</span>

<span class="sd">    bg = zircon.BrowserGroup(&quot;public&quot;, 5)</span>
<span class="sd">    # bg = zircon.BrowserGroup([&quot;public&quot;, &quot;starcraft&quot;], 5) # or can also be this</span>
<span class="sd">    await bg.execute(crawl)</span>

<span class="sd">The last command will run the crawl function over and over again, as long as there&#39;s a free browser</span>
<span class="sd">to do it. Also, by default, this will only use inactive browsers (no Python clients are sending them</span>
<span class="sd">commands for a while, configurable at ``settings.zircon.conflictDuration``)</span>

<span class="sd">Notice how I wrapped all browser interactions inside a try-except block? If some errors were to</span>
<span class="sd">appear, like connection lost and the system is trying to restore the connection and you don&#39;t</span>
<span class="sd">resolve it, .execute() will throw that same error and cancels all current tasks. So if you want</span>
<span class="sd">to design something that will run for a long time, catch it and try to schedule the job for later</span>

<span class="sd">:param aFn: async function to be executed</span>
<span class="sd">:param timeout: if the function takes longer than this amount of time,</span>
<span class="sd">    then cancel the task and make the browser available in the future</span>
<span class="sd">    again. Can be None, but I&#39;d advise against that&quot;&quot;&quot;</span>                           <span class="c1"># BrowserGroup</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setupGuard</span><span class="p">();</span> <span class="n">nCancelled</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">avaiBs</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_browsers</span><span class="p">))</span> <span class="c1"># BrowserGroup</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_browsers</span><span class="p">);</span> <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">];</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>                <span class="c1"># BrowserGroup</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>                                                      <span class="c1"># BrowserGroup</span>
            <span class="k">try</span><span class="p">:</span>                                                                 <span class="c1"># BrowserGroup</span>
                <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">await</span> <span class="n">aFn</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="n">avaiBs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>               <span class="c1"># BrowserGroup</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">aFn</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">timeout</span><span class="p">);</span> <span class="n">avaiBs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># BrowserGroup</span>
            <span class="k">except</span> <span class="n">BrowserCancel</span><span class="p">:</span> <span class="n">nCancelled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>                             <span class="c1"># BrowserGroup</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span> <span class="n">avaiBs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>                        <span class="c1"># BrowserGroup</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()]</span>       <span class="c1"># BrowserGroup</span>
            <span class="c1"># print(f&quot;Encountered error {e} while executing async function. Stopping BrowserGroup.execute(). Traceback:\n\n{traceback.format_exc()}&quot;) # BrowserGroup</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                              <span class="c1"># BrowserGroup</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">done</span><span class="p">():</span> <span class="n">tasks</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span> <span class="c1"># cleaning up old tasks # BrowserGroup</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># trouble! Cancel all current tasks and break          # BrowserGroup</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>                                 <span class="c1"># BrowserGroup</span>
                <span class="n">e</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception occured during BrowserGroup.execute(): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Traceback:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">tb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># BrowserGroup</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Executing. #browsers=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> #running=</span><span class="si">{</span><span class="n">n</span><span class="o">-</span><span class="n">nCancelled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> #tasks=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="si">}</span><span class="s2">  &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># BrowserGroup</span>
            <span class="k">try</span><span class="p">:</span>                                                                 <span class="c1"># BrowserGroup</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">avaiBs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>                                             <span class="c1"># BrowserGroup</span>
                    <span class="k">if</span> <span class="n">nCancelled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_browsers</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task finished&quot;</span><span class="p">);</span> <span class="k">break</span> <span class="c1"># BrowserGroup</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>                                     <span class="c1"># BrowserGroup</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">inner</span><span class="p">(</span><span class="n">avaiBs</span><span class="o">.</span><span class="n">popleft</span><span class="p">())))</span> <span class="c1"># BrowserGroup</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>                                       <span class="c1"># BrowserGroup</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>                                 <span class="c1"># BrowserGroup</span>
                <span class="k">break</span>                                                            <span class="c1"># BrowserGroup</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Quang Ho.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>k1lib._basics &mdash; k1lib 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> k1lib
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../bioinfo/index.html">k1lib.bioinfo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../callbacks/index.html">k1lib.callbacks package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">k1lib.data module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../eqn.html">k1lib.eqn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../format.html">k1lib.format module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphEqn.html">k1lib.graphEqn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../imports.html">k1lib.imports module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nn.html">k1lib.nn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">k1lib.schedule module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../selector.html">k1lib.selector module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../viz.html">k1lib.viz module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../website.html">k1lib.website module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelogs.html">Changelogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../monkeyPatches.html">Monkey patched classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">k1lib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>k1lib._basics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for k1lib._basics</h1><div class="highlight"><pre>
<span></span><span class="c1"># AUTOGENERATED FILE! PLEASE DON&#39;T EDIT</span>
<span class="kn">import</span> <span class="nn">torch</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">overload</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Iterator</span>\
<span class="p">,</span> <span class="n">ContextManager</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_docsUrl&quot;</span><span class="p">,</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span> <span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="s2">&quot;Domain&quot;</span><span class="p">,</span>
           <span class="s2">&quot;CancelRunException&quot;</span><span class="p">,</span> <span class="s2">&quot;CancelEpochException&quot;</span><span class="p">,</span> <span class="s2">&quot;CancelBatchException&quot;</span><span class="p">,</span>
           <span class="s2">&quot;textToHtml&quot;</span><span class="p">,</span> <span class="s2">&quot;clearLine&quot;</span><span class="p">,</span> <span class="s2">&quot;tab&quot;</span><span class="p">,</span> <span class="s2">&quot;isNumeric&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;stats&quot;</span><span class="p">,</span>
           <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;squeeze&quot;</span><span class="p">,</span> <span class="s2">&quot;raiseEx&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth&quot;</span><span class="p">,</span> <span class="s2">&quot;numDigits&quot;</span><span class="p">,</span> <span class="s2">&quot;limitLines&quot;</span><span class="p">,</span>
           <span class="s2">&quot;limitChars&quot;</span><span class="p">,</span> <span class="s2">&quot;showLog&quot;</span><span class="p">,</span> <span class="s2">&quot;cleanDiv&quot;</span><span class="p">,</span> <span class="s2">&quot;beep&quot;</span><span class="p">,</span> <span class="s2">&quot;executeNb&quot;</span><span class="p">,</span> <span class="s2">&quot;dontWrap&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Func&quot;</span><span class="p">,</span> <span class="s2">&quot;polyfit&quot;</span><span class="p">,</span> <span class="s2">&quot;derivative&quot;</span><span class="p">,</span> <span class="s2">&quot;optimize&quot;</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">,</span> <span class="s2">&quot;integrate&quot;</span><span class="p">]</span>
<span class="n">_docsUrl</span> <span class="o">=</span> <span class="s2">&quot;https://k1lib.github.io&quot;</span>
<div class="viewcode-block" id="Object"><a class="viewcode-back" href="../../index.html#k1lib.Object">[docs]</a><span class="k">class</span> <span class="nc">Object</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convenience class that acts like ``defaultdict``. You can use</span>
<span class="sd">it like a normal object::</span>

<span class="sd">    a = Object()</span>
<span class="sd">    a.b = 3</span>
<span class="sd">    print(a.b) # outputs &quot;3&quot;</span>

<span class="sd">``__repr__()`` output is pretty nice too:</span>

<span class="sd">.. code-block:: text</span>

<span class="sd">    &lt;class &#39;__main__.Object&#39;&gt;, with attrs:</span>
<span class="sd">    - b</span>

<span class="sd">You can instantiate it from a dict::</span>

<span class="sd">    a = Object.fromDict({&quot;b&quot;: 3, &quot;c&quot;: 4})</span>
<span class="sd">    print(a.c) # outputs &quot;4&quot;</span>

<span class="sd">And you can specify a default value, just like defaultdict::</span>

<span class="sd">    a = Object().withAutoDeclare(lambda: [])</span>
<span class="sd">    a.texts.extend([&quot;factorio&quot;, &quot;world of warcraft&quot;])</span>
<span class="sd">    print(a.texts[0]) # outputs &quot;factorio&quot;</span>
<span class="sd">    </span>
<span class="sd">.. warning::</span>

<span class="sd">    Default values only work with variables that don&#39;t start with an</span>
<span class="sd">    underscore &quot;_&quot;.</span>

<span class="sd">Treating it like defaultdict is okay too::</span>

<span class="sd">    a = Object().withAutoDeclare(lambda: [])</span>
<span class="sd">    a[&quot;movies&quot;].append(&quot;dune&quot;)</span>
<span class="sd">    print(a.movies[0]) # outputs &quot;dune&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr</span> <span class="o">=</span> <span class="kc">None</span>
<div class="viewcode-block" id="Object.fromDict"><a class="viewcode-back" href="../../index.html#k1lib.Object.fromDict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromDict</span><span class="p">(</span><span class="n">_dict</span><span class="p">:</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Creates an object with attributes from a dictionary&quot;&quot;&quot;</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">Object</span><span class="p">();</span> <span class="n">answer</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict</span><span class="p">);</span> <span class="k">return</span> <span class="n">answer</span></div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Essentially ``__dict__``, but only outputs the fields you</span>
<span class="sd">defined. If your framework intentionally set some attributes, those</span>
<span class="sd">will be reported too, so beware&quot;&quot;&quot;</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">);</span> <span class="k">del</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&quot;_defaultValueGenerator&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&quot;repr&quot;</span><span class="p">];</span> <span class="n">answer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;getdoc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="k">return</span> <span class="n">answer</span>
<div class="viewcode-block" id="Object.withAutoDeclare"><a class="viewcode-back" href="../../index.html#k1lib.Object.withAutoDeclare">[docs]</a>    <span class="k">def</span> <span class="nf">withAutoDeclare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaultValueGenerator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets this Object up so that if a field doesn&#39;t</span>
<span class="sd">        exist, it will automatically create it with a</span>
<span class="sd">        default value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span> <span class="o">=</span> <span class="n">defaultValueGenerator</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>
<div class="viewcode-block" id="Object.withRepr"><a class="viewcode-back" href="../../index.html#k1lib.Object.withRepr">[docs]</a>    <span class="k">def</span> <span class="nf">withRepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_repr</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specify output of ``__repr__()``. Legacy code. You can just</span>
<span class="sd">monkey patch it instead.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repr</span> <span class="o">=</span> <span class="n">_repr</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_dict</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, with attrs:</span><span class="se">\n</span><span class="si">{</span><span class="n">_dict</span><span class="si">}</span><span class="s2">&quot;</span></div>
<div class="viewcode-block" id="CancelRunException"><a class="viewcode-back" href="../../index.html#k1lib.CancelRunException">[docs]</a><span class="k">class</span> <span class="nc">CancelRunException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used in core training loop, to skip the run entirely&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="CancelEpochException"><a class="viewcode-back" href="../../index.html#k1lib.CancelEpochException">[docs]</a><span class="k">class</span> <span class="nc">CancelEpochException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used in core training loop, to skip to next epoch&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="CancelBatchException"><a class="viewcode-back" href="../../index.html#k1lib.CancelBatchException">[docs]</a><span class="k">class</span> <span class="nc">CancelBatchException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used in core training loop, to skip to next batch&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="textToHtml"><a class="viewcode-back" href="../../index.html#k1lib.textToHtml">[docs]</a><span class="k">def</span> <span class="nf">textToHtml</span><span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Transform a string so that it looks the same on browsers</span>
<span class="sd">as in `print()`&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;nbsp;&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="clearLine"><a class="viewcode-back" href="../../index.html#k1lib.clearLine">[docs]</a><span class="k">def</span> <span class="nf">clearLine</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Prints a character that clears the current line&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="tab"><a class="viewcode-back" href="../../index.html#k1lib.tab">[docs]</a><span class="k">def</span> <span class="nf">tab</span><span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Adds a tab before each line. str in, str out. List in, list out&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="p">]</span></div>
<div class="viewcode-block" id="isNumeric"><a class="viewcode-back" href="../../index.html#k1lib.isNumeric">[docs]</a><span class="k">def</span> <span class="nf">isNumeric</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns whether object is actually a number&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span></div>
<div class="viewcode-block" id="close"><a class="viewcode-back" href="../../index.html#k1lib.close">[docs]</a><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns whether 2 values are really close to each other&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">b</span><span class="p">))</span></div>
<div class="viewcode-block" id="stats"><a class="viewcode-back" href="../../index.html#k1lib.stats">[docs]</a><span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns the mean and standard deviation of the input&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span></div>
<div class="viewcode-block" id="patch"><a class="viewcode-back" href="../../index.html#k1lib.patch">[docs]</a><span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="n">_class</span><span class="p">:</span><span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">static</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Patches a function to a class/object.</span>

<span class="sd">:param _class: object to patch function. Can also be a type</span>
<span class="sd">:param name: name of patched function, if different from current</span>
<span class="sd">:param docs: docs of patched function. Can be object with __doc__ attr</span>
<span class="sd">:param static: whether to wrap this inside :class:`staticmethod` or not</span>

<span class="sd">Intended to be used like this::</span>

<span class="sd">    class A:</span>
<span class="sd">        def methA(self):</span>
<span class="sd">            return &quot;inside methA&quot;</span>

<span class="sd">    @patch(A)</span>
<span class="sd">    def methB(self):</span>
<span class="sd">        return &quot;inside methB&quot;</span>
<span class="sd">        </span>
<span class="sd">    a = A()</span>
<span class="sd">    print(a.methB()) # will print &quot;inside methB&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
        <span class="n">_docs</span> <span class="o">=</span> <span class="n">docs</span>
        <span class="k">if</span> <span class="n">_docs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_docs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="n">_docs</span> <span class="o">=</span> <span class="n">_docs</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">_docs</span> <span class="o">=</span> <span class="n">_docs</span> <span class="ow">or</span> <span class="n">function</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="n">_class</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">function</span><span class="o">.</span><span class="vm">__qualname__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">_function</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="k">if</span> <span class="n">static</span> <span class="k">else</span> <span class="n">function</span>
        <span class="n">_function</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_docs</span><span class="p">;</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">_class</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_function</span><span class="p">);</span> <span class="k">return</span> <span class="n">_function</span>
    <span class="k">return</span> <span class="n">inner</span></div>
<div class="viewcode-block" id="squeeze"><a class="viewcode-back" href="../../index.html#k1lib.squeeze">[docs]</a><span class="k">def</span> <span class="nf">squeeze</span><span class="p">(</span><span class="n">_list</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">hard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If list only has 1 element, rethrn that element, else return original list</span>

<span class="sd">:param hard: If True, then if list/tuple, filters out None, and takes the first</span>
<span class="sd">    element out even if that list/tuple has more than 1 element&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">hard</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">_list</span> <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_list</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span> <span class="k">return</span> <span class="n">_list</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_list</span></div>
<div class="viewcode-block" id="raiseEx"><a class="viewcode-back" href="../../index.html#k1lib.raiseEx">[docs]</a><span class="k">def</span> <span class="nf">raiseEx</span><span class="p">(</span><span class="n">ex</span><span class="p">:</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raises a specific exception. May be useful in lambdas&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ex</span></div>
<div class="viewcode-block" id="smooth"><a class="viewcode-back" href="../../index.html#k1lib.smooth">[docs]</a><span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">consecutives</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Smoothes out array, so that y values are averages of the neighbors&quot;&quot;&quot;</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">elem</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">consecutives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">consecutives</span><span class="p">);</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">answer</span></div>
<div class="viewcode-block" id="numDigits"><a class="viewcode-back" href="../../index.html#k1lib.numDigits">[docs]</a><span class="k">def</span> <span class="nf">numDigits</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the number of digits/characters of this number/object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="limitLines"><a class="viewcode-back" href="../../index.html#k1lib.limitLines">[docs]</a><span class="k">def</span> <span class="nf">limitLines</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;If input string is too long, truncates it and adds ellipsis&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splits</span> <span class="o">:=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">splits</span><span class="p">[:</span><span class="n">limit</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.....&quot;</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span></div>
<div class="viewcode-block" id="limitChars"><a class="viewcode-back" href="../../index.html#k1lib.limitChars">[docs]</a><span class="k">def</span> <span class="nf">limitChars</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If input string is too long, truncates to first `limit` characters of the first line&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="o">-</span><span class="mi">3</span> <span class="k">else</span> <span class="n">s</span></div>
<div class="viewcode-block" id="showLog"><a class="viewcode-back" href="../../index.html#k1lib.showLog">[docs]</a><span class="k">def</span> <span class="nf">showLog</span><span class="p">(</span><span class="n">loggerName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prints out logs of a particular logger at a particular level&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">loggerName</span><span class="p">);</span> <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">();</span> <span class="n">sh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">);</span> <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span></div>
<span class="k">def</span> <span class="nf">cleanDiv</span><span class="p">(</span><span class="n">_list</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">total</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Cleanly divides :total: into int segments with weights specified by</span>
<span class="sd">:_list:. Looks like this: ``(_list / _list.sum()) * total``, but</span>
<span class="sd">everything is an ``int``&quot;&quot;&quot;</span>
    <span class="n">_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_list</span><span class="p">)</span>
    <span class="n">_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">_list</span><span class="o">*</span><span class="n">total</span><span class="o">/</span><span class="n">_list</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_list</span>
<span class="n">ninf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">);</span> <span class="n">inf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Range"><a class="viewcode-back" href="../../index.html#k1lib.Range">[docs]</a><span class="k">class</span> <span class="nc">Range</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A range of numbers. It&#39;s just 2 numbers really: start and stop</span>

<span class="sd">This is essentially a convenience class to provide a nice, clean</span>
<span class="sd">abstraction and to eliminate errors. You can transform values::</span>

<span class="sd">    Range(10, 20).toUnit(13) # returns 0.3</span>
<span class="sd">    Range(10, 20).fromUnit(0.3) # returns 13</span>
<span class="sd">    Range(10, 20).toRange(Range(20, 10), 13) # returns 17</span>

<span class="sd">You can also do random math operations on it::</span>

<span class="sd">    (Range(10, 20) * 2 + 3) == Range(23, 43) # returns True</span>
<span class="sd">    Range(10, 20) == ~Range(20, 10) # returns True&quot;&quot;&quot;</span>
<div class="viewcode-block" id="Range.__init__"><a class="viewcode-back" href="../../index.html#k1lib.Range.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new Range.</span>

<span class="sd">There are different ``__init__`` functions for many situations:</span>

<span class="sd">- Range(2, 11.1): create range [2, 11.1]</span>
<span class="sd">- Range(15.2): creates range [0, 15.2]</span>
<span class="sd">- Range(Range(2, 3)): create range [2, 3]. This serves as sort of a catch-all</span>
<span class="sd">- Range(slice(2, 5, 2)): creates range [2, 5]. Can also be a :class:`range`</span>
<span class="sd">- Range(slice(2, -1), 10): creates range [2, 9]</span>
<span class="sd">- Range([1, 2, 7, 5]): creates range [1, 5]. Can also be a tuple</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isNumeric</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">stop</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span>
        <span class="k">elif</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">start</span>
        <span class="k">elif</span> <span class="n">stop</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">Range</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">stop</span>
        <span class="k">elif</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">stop</span><span class="p">)[</span><span class="n">start</span><span class="p">];</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t understand </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span></div>
<div class="viewcode-block" id="Range.__getitem__"><a class="viewcode-back" href="../../index.html#k1lib.Range.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;0 for start, 1 for stop</span>

<span class="sd">You can also pass in a :class:`slice` object, in which case, a range subset</span>
<span class="sd">will be returned. Code kinda looks like this::</span>

<span class="sd">    range(start, stop)[index]</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">slice</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t get index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> of range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="Range.fixOrder"><a class="viewcode-back" href="../../index.html#k1lib.Range.fixOrder">[docs]</a>    <span class="k">def</span> <span class="nf">fixOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Range&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;If start greater than stop, switch the 2, else do nothing&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="nf">_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">Range</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">stop</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">stop</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Doesn&#39;t understand </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">;</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
<div class="viewcode-block" id="Range.intIter"><a class="viewcode-back" href="../../index.html#k1lib.Range.intIter">[docs]</a>    <span class="k">def</span> <span class="nf">intIter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Returns integers within this Range&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span></div>
<div class="viewcode-block" id="Range.toUnit"><a class="viewcode-back" href="../../index.html#k1lib.Range.toUnit">[docs]</a>    <span class="k">def</span> <span class="nf">toUnit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts x from current range to [0, 1] range. Example::</span>

<span class="sd">    r = Range(2, 10)</span>
<span class="sd">    r.toUnit(5) # will return 0.375, as that is (5-2)/(10-2)</span>

<span class="sd">You can actually pass in a lot in place of x::</span>

<span class="sd">    r = Range(0, 10)</span>
<span class="sd">    r.toUnit([5, 3, 6]) # will be [0.5, 0.3, 0.6]. Can also be a tuple</span>
<span class="sd">    r.toUnit(slice(5, 6)) # will be slice(0.5, 0.6). Can also be a range, or Range</span>

<span class="sd">.. note::</span>

<span class="sd">    In the last case, if ``start`` is None, it gets defaulted to 0, and</span>
<span class="sd">    if ``end`` is None, it gets defaulted to 1</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span></div>
<div class="viewcode-block" id="Range.fromUnit"><a class="viewcode-back" href="../../index.html#k1lib.Range.fromUnit">[docs]</a>    <span class="k">def</span> <span class="nf">fromUnit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts x from [0, 1] range to this range. Example::</span>

<span class="sd">    r = Range(0, 10)</span>
<span class="sd">    r.fromUnit(0.3) # will return 3</span>

<span class="sd">x can be a lot of things, see :meth:`toUnit` for more&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span></div>
<div class="viewcode-block" id="Range.toRange"><a class="viewcode-back" href="../../index.html#k1lib.Range.toRange">[docs]</a>    <span class="k">def</span> <span class="nf">toRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_range</span><span class="p">:</span><span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts x from current range to another range. Example::</span>

<span class="sd">    r = Range(0, 10)</span>
<span class="sd">    r.toRange(Range(0, 100), 6) # will return 60</span>

<span class="sd">x can be a lot of things, see :meth:`toUnit` for more.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Range</span><span class="p">(</span><span class="n">_range</span><span class="p">)</span><span class="o">.</span><span class="n">fromUnit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toUnit</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span></div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">range_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a :class:`range` object with start and stop values</span>
<span class="sd">rounded off&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="o">+</span><span class="mf">0.001</span><span class="p">))</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slice_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a :class:`slice` object with start and stop values</span>
<span class="sd">rounded off&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="o">+</span><span class="mf">0.001</span><span class="p">))</span>
<div class="viewcode-block" id="Range.proportionalSlice"><a class="viewcode-back" href="../../index.html#k1lib.Range.proportionalSlice">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">proportionalSlice</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r1Slice</span><span class="p">:</span><span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="s2">&quot;Range&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Slices r1 and r2 proportionally. Best to explain using an</span>
<span class="sd">example. Let&#39;s say you have 2 arrays created from a time-dependent</span>
<span class="sd">procedure like this::</span>

<span class="sd">    a = []; b = []</span>
<span class="sd">    for t in range(100):</span>
<span class="sd">        if t % 3 == 0: a.append(t)</span>
<span class="sd">        if t % 5 == 0: b.append(1 - t)</span>
<span class="sd">    len(a), len(b) # returns (34, 20)</span>

<span class="sd">a and b are of different lengths, but you want to plot both from 30%</span>
<span class="sd">mark to 50% mark (for a, it&#39;s elements 10 -&gt; 17, for b it&#39;s 6 -&gt; 10),</span>
<span class="sd">as they are time-dependent. As you can probably tell, to get the indicies</span>
<span class="sd">10, 17, 6, 10 is messy. So, you can do something like this instead::</span>

<span class="sd">    r1, r2 = Range.proportionalSlice(Range(len(a)), Range(len(b)), slice(10, 17))</span>

<span class="sd">This will return the Ranges [10, 17] and [5.88, 10]</span>

<span class="sd">Then, you can plot both of them side by side like this::</span>

<span class="sd">    fig, axes = plt.subplots(ncols=2)</span>
<span class="sd">    axes[0].plot(r1.range_, a[r1.slice_])</span>
<span class="sd">    axes[1].plot(r2.range_, a[r2.slice_])</span>
<span class="sd">&quot;&quot;&quot;</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span> <span class="n">Range</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">ar2</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">toRange</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="p">(</span><span class="n">ar1</span> <span class="o">:=</span> <span class="n">r1</span><span class="p">[</span><span class="n">r1Slice</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span></div>
<div class="viewcode-block" id="Range.bound"><a class="viewcode-back" href="../../index.html#k1lib.Range.bound">[docs]</a>    <span class="k">def</span> <span class="nf">bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rs</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;If input range|slice&#39;s stop and start is missing, then use this</span>
<span class="sd">range&#39;s start and stop instead.&quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">stop</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">rs</span><span class="p">)(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span></div>
<div class="viewcode-block" id="Range.copy"><a class="viewcode-back" href="../../index.html#k1lib.Range.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_range</span><span class="p">):</span>
        <span class="n">_range</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="ow">and</span>\
            <span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
<div class="viewcode-block" id="Range.__invert__"><a class="viewcode-back" href="../../index.html#k1lib.Range.__invert__">[docs]</a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">+</span> <span class="n">num</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">num</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">*</span> <span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">num</span>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">num</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">raise</span> <span class="s2">&quot;Doesn&#39;t make sense to do this!&quot;</span>
    <span class="k">def</span> <span class="fm">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__ceil__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__floor__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;A range of numbers: [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]. Can do:</span>
<span class="s2">- r.toUnit(x): will convert x from range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">] to [0, 1]</span>
<span class="s2">- r.fromUnit(x): will convert x from range [0, 1] to range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]</span>
<span class="s2">- r.toRange([a, b], x): will convert x from range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">] to range [a, b]</span>
<span class="s2">- r[0], r[1], r.start, r.stop: get start and stop values of range</span>

<span class="s2">Note: for conversion methods, you can pass in&quot;&quot;&quot;</span></div>
<span class="k">def</span> <span class="nf">yieldLowest</span><span class="p">(</span><span class="n">r1s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">],</span> <span class="n">r2s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Given 2 :class:`Range` generators with lengths a and b, yield every</span>
<span class="sd">object (a + b) so that :class:`Range`s with smaller start point gets yielded</span>
<span class="sd">first. Assumes that each generator:</span>

<span class="sd">- Does not intersect with itself</span>
<span class="sd">- Is sorted by start point already</span>

<span class="sd">.. warning::</span>

<span class="sd">    This method will sometimes yield the same objects given by the Iterators.</span>
<span class="sd">    Make sure you copy each :class:`Range` if your use case requires&quot;&quot;&quot;</span>
    <span class="n">r1s</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">r1s</span><span class="p">);</span> <span class="n">r2s</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">r2s</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r1</span> <span class="o">:=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield from</span> <span class="n">r2s</span><span class="p">;</span> <span class="k">return</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r2</span> <span class="o">:=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r2s</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r1</span><span class="p">;</span> <span class="k">yield from</span> <span class="n">r1s</span><span class="p">;</span> <span class="k">return</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">r1</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">r1</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r2</span><span class="p">;</span> <span class="k">yield from</span> <span class="n">r2s</span><span class="p">;</span> <span class="k">return</span>
        <span class="k">while</span> <span class="n">r2</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">r1</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">r2</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r2s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r1</span><span class="p">;</span> <span class="k">yield from</span> <span class="n">r1s</span><span class="p">;</span> <span class="k">return</span>
<span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">r1s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">],</span> <span class="n">r2s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Joins 2 :class:`Range` generators, so that overlaps gets merged</span>
<span class="sd">together.</span>

<span class="sd">.. warning::</span>

<span class="sd">    This method will sometimes yield the same objects given by the Iterators.</span>
<span class="sd">    Make sure you copy each :class:`Range` if your use case requires&quot;&quot;&quot;</span>
    <span class="n">it</span> <span class="o">=</span> <span class="n">yieldLowest</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="n">r2s</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">:=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span><span class="p">;</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span> <span class="o">&gt;=</span> <span class="n">nr</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">nr</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">nr</span>
<span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="n">rs</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Returns R - rs, where R is the set of real numbers.&quot;&quot;&quot;</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">:=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">ninf</span><span class="p">,</span> <span class="n">inf</span><span class="p">);</span> <span class="k">return</span>
    <span class="k">if</span> <span class="n">ninf</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">ninf</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="c1"># check -inf case</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">:=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">inf</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">inf</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
<div class="viewcode-block" id="Domain"><a class="viewcode-back" href="../../index.html#k1lib.Domain">[docs]</a><span class="k">class</span> <span class="nc">Domain</span><span class="p">:</span>
<div class="viewcode-block" id="Domain.__init__"><a class="viewcode-back" href="../../index.html#k1lib.Domain.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">ranges</span><span class="p">,</span> <span class="n">dontCheck</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new domain.</span>

<span class="sd">:param ranges: each element is a :class:`Range`, although any format will be fine as this selects for that</span>
<span class="sd">:param dontCheck: don&#39;t sanitize inputs, intended to boost perf internally only</span>

<span class="sd">A domain is just an array of :class:`Range` that represents what intervals on</span>
<span class="sd">the real number line is chosen. Some examples::</span>

<span class="sd">    inf = float(&quot;inf&quot;) # shorthand for infinity</span>
<span class="sd">    Domain([5, 7.5], [2, 3]) # represents &quot;[2, 3) U [5, 7.5)&quot;</span>
<span class="sd">    Domain([2, 3.2], [3, 8]) # represents &quot;[2, 8)&quot; as overlaps are merged</span>
<span class="sd">    -Domain([2, 3]) # represents &quot;(-inf, 2) U [3, inf)&quot;, so essentially R - d, with R being the set of real numbers</span>
<span class="sd">    -Domain([-inf, 3]) # represents &quot;[3, inf)&quot;</span>
<span class="sd">    Domain.fromInts(2, 3, 6) # represents &quot;[2, 4) U [6, 7)&quot;</span>

<span class="sd">You can also do arithmetic on them, and check &quot;in&quot; oeprator::</span>

<span class="sd">    Domain([2, 3]) + Domain([4, 5]) # represents &quot;[2, 3) U [4, 5)&quot;</span>
<span class="sd">    Domain([2, 3]) + Domain([2.9, 5]) # represents &quot;[2, 5)&quot;, also merges overlaps</span>
<span class="sd">    3 in Domain([2, 3]) # returns False</span>
<span class="sd">    2 in Domain([2, 3]) # returns True&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dontCheck</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ranges</span><span class="p">);</span> <span class="k">return</span>
        <span class="c1"># convert all to Range type, fix its order, and sort based on .start</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">r</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Range</span><span class="p">)</span> <span class="k">else</span> <span class="n">Range</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">fixOrder</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">]</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="c1"># merges overlapping segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="p">[]))</span></div>
<div class="viewcode-block" id="Domain.fromInts"><a class="viewcode-back" href="../../index.html#k1lib.Domain.fromInts">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromInts</span><span class="p">(</span><span class="o">*</span><span class="n">ints</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Returns a new :class:`Domain` which has ranges [i, i+1] for each</span>
<span class="sd">int given.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">Range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ints</span><span class="p">))</span></div>
<div class="viewcode-block" id="Domain.copy"><a class="viewcode-back" href="../../index.html#k1lib.Domain.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">))</span></div>
<div class="viewcode-block" id="Domain.intIter"><a class="viewcode-back" href="../../index.html#k1lib.Domain.intIter">[docs]</a>    <span class="k">def</span> <span class="nf">intIter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yields ints in all ranges of this domain. If first range&#39;s domain</span>
<span class="sd">is :math:`(-\inf, a)`, then starts at the specified integer&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="n">inf</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span> <span class="k">yield</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">step</span></div>
    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="n">neg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">),</span> <span class="n">dontCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">ranges</span><span class="p">)),</span> <span class="n">dontCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">domain</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">==</span> <span class="n">domain</span><span class="o">.</span><span class="n">ranges</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Domain: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Domain:</span><span class="se">\n</span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Can:</span>
<span class="s2">- 3 in d: check whether a number is in this domain or not</span>
<span class="s2">- d1 + d2: joins 2 domain</span>
<span class="s2">- -d: excludes the domain from R</span>
<span class="s2">- d1 - d2: same as d1 + (-d2)&quot;&quot;&quot;</span></div>
<span class="n">Func</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>
<div class="viewcode-block" id="polyfit"><a class="viewcode-back" href="../../index.html#k1lib.polyfit">[docs]</a><span class="k">def</span> <span class="nf">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">deg</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Func</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns a function that approximate :math:`f(x) = y`.</span>

<span class="sd">:param deg: degree of the polynomial of the returned function</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">_x</span><span class="p">):</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expo</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">answer</span> <span class="o">+=</span> <span class="n">param</span> <span class="o">*</span> <span class="n">_x</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">-</span><span class="n">expo</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">answer</span>
    <span class="k">return</span> <span class="n">_inner</span></div>
<div class="viewcode-block" id="derivative"><a class="viewcode-back" href="../../index.html#k1lib.derivative">[docs]</a><span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">Func</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Func</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the derivative of a function&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">delta</span></div>
<div class="viewcode-block" id="optimize"><a class="viewcode-back" href="../../index.html#k1lib.optimize">[docs]</a><span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">Func</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Given :math:`f(x) = 0`, solves for x, using initial value `v`&quot;&quot;&quot;</span>
    <span class="n">fD</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">fD</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>
<div class="viewcode-block" id="inverse"><a class="viewcode-back" href="../../index.html#k1lib.inverse">[docs]</a><span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">Func</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Func</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the inverse of a function. The inverse function takes</span>
<span class="sd">a long time to run, so don&#39;t use this where you need lots</span>
<span class="sd">of speed.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrate"><a class="viewcode-back" href="../../index.html#k1lib.integrate">[docs]</a><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">Func</span><span class="p">,</span> <span class="n">_range</span><span class="p">:</span><span class="n">Range</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Integrates a function over a range&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">_range</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">_range</span><span class="o">.</span><span class="n">delta</span><span class="o">/</span><span class="n">n</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">])</span></div>
<span class="nd">@patch</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;importParams&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_importParams</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Given a list of :class:`torch.nn.parameter.Parameter`/:class:`torch.Tensor`,</span>
<span class="sd">update the current :class:`torch.nn.Module`&#39;s parameters with it&#39;&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">oldParam</span><span class="p">,</span> <span class="n">newParam</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">oldParam</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">newParam</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="nd">@patch</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;exportParams&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_exportParams</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Gets the list of :class:`torch.nn.parameter.Parameter` data&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">()]</span>
<span class="nd">@patch</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;getParamsVector&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_getParamsVector</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;For each parameter, returns a normal distributed random tensor</span>
<span class="sd">with the same standard deviation as the original parameter&quot;&quot;&quot;</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">answer</span>
<span class="k">class</span> <span class="nc">_NnModuleDeviceContext</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nnModule</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nnModule</span> <span class="o">=</span> <span class="n">nnModule</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">device</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModule</span><span class="o">.</span><span class="n">parameters</span><span class="p">()]</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">ignored</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nnModule</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;preserveDevice&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_preserveDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Preserves the device of whatever operation is inside this. Example::</span>

<span class="sd">    import torch.nn as nn</span>
<span class="sd">    m = nn.Linear(3, 4)</span>
<span class="sd">    with m.preserveDevice():</span>
<span class="sd">        m.cuda() # moves whole model to cuda</span>
<span class="sd">    # automatically moves model to cpu</span>

<span class="sd">This will work even if the model has many tensors that live on 10 different devices.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_NnModuleDeviceContext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<div class="viewcode-block" id="beep"><a class="viewcode-back" href="../../index.html#k1lib.beep">[docs]</a><span class="k">def</span> <span class="nf">beep</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Plays a beeping sound, may be useful as notification for long-running tasks&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">IPython</span><span class="p">;</span> <span class="n">IPython</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display_html</span><span class="p">(</span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;script&gt;(new Audio(&#39;data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU&#39;+Array(1e3).join(123))).play();&lt;/script&gt;&quot;&quot;&quot;</span><span class="p">));</span>
    <span class="k">except</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">os</span><span class="p">;</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;printf &#39;</span><span class="se">\a</span><span class="s2">&#39;&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="executeNb"><a class="viewcode-back" href="../../index.html#k1lib.executeNb">[docs]</a><span class="k">def</span> <span class="nf">executeNb</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">_globals</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Executes a specified IPython notebook. Can make all variables</span>
<span class="sd">defined in the notebook appear in the __main__ context by</span>
<span class="sd">passing `globals()` in&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())[</span><span class="s2">&quot;cells&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cell</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="s2">&quot;cell_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;code&quot;</span><span class="p">]),</span> <span class="n">_globals</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Msg </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="si">}</span><span class="s2">, line </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="dontWrap"><a class="viewcode-back" href="../../index.html#k1lib.dontWrap">[docs]</a><span class="k">def</span> <span class="nf">dontWrap</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Don&#39;t wrap horizontally when in a notebook&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;div.jp-OutputArea-output pre {white-space: pre;}&lt;/style&gt;&quot;</span><span class="p">))</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;div.output_area pre {white-space: pre;}&lt;/style&gt;&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t run dontWrap()&quot;</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Quang Ho.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
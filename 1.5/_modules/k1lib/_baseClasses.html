<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>k1lib._baseClasses &mdash; k1lib  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> k1lib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../base.html">Base module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli/index.html">k1lib.cli module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../callbacks/index.html">k1lib.callbacks module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../k1a.html">k1lib._k1a module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../k1ui.html">k1lib.k1ui module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../eqn.html">k1lib.eqn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fmt.html">k1lib.fmt module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphEqn.html">k1lib.graphEqn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../imports.html">k1lib.imports module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mo.html">k1lib.mo module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knn.html">k1lib.knn module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../p5.html">k1lib.p5 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">k1lib.schedule module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../selector.html">k1lib.selector module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../selen.html">k1lib.selen module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../serpent.html">k1lib.serpent module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../serve.html">k1lib.serve module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../viz.html">k1lib.viz module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../monkey.html">Monkey patched classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelogs.html">Changelogs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">k1lib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">k1lib._baseClasses</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for k1lib._baseClasses</h1><div class="highlight"><pre>
<span></span><span class="c1"># AUTOGENERATED FILE! PLEASE DON&#39;T EDIT HERE. EDIT THE SOURCE NOTEBOOKS INSTEAD</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: k1lib</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">k1lib</span> <span class="kn">import</span> <span class="n">isNumeric</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">k1lib</span><span class="o">,</span> <span class="nn">contextlib</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">dep</span><span class="p">(</span><span class="s2">&quot;matplotlib.pyplot&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">torch</span><span class="p">;</span> <span class="n">hasTorch</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span> <span class="n">hasTorch</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Object&quot;</span><span class="p">,</span> <span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="s2">&quot;Domain&quot;</span><span class="p">,</span> <span class="s2">&quot;AutoIncrement&quot;</span><span class="p">,</span> <span class="s2">&quot;Wrapper&quot;</span><span class="p">,</span> <span class="s2">&quot;Every&quot;</span><span class="p">,</span>
           <span class="s2">&quot;RunOnce&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxDepth&quot;</span><span class="p">,</span> <span class="s2">&quot;MovingAvg&quot;</span><span class="p">,</span> <span class="s2">&quot;Absorber&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="s2">&quot;_settings&quot;</span><span class="p">,</span> <span class="s2">&quot;UValue&quot;</span><span class="p">,</span> <span class="s2">&quot;ConstantPad&quot;</span><span class="p">]</span>
<div class="viewcode-block" id="Object"><a class="viewcode-back" href="../../base.html#k1lib.Object">[docs]</a><span class="k">class</span> <span class="nc">Object</span><span class="p">:</span>                                                                    <span class="c1"># Object</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience class that acts like :class:`~collections.defaultdict`. You</span>
<span class="sd">can use it like a normal object::</span>

<span class="sd">    a = k1lib.Object()</span>
<span class="sd">    a.b = 3</span>
<span class="sd">    print(a.b) # outputs &quot;3&quot;</span>

<span class="sd">``__repr__()`` output is pretty nice too:</span>

<span class="sd">.. code-block:: text</span>

<span class="sd">    &lt;class &#39;__main__.Object&#39;&gt;, with attrs:</span>
<span class="sd">    - b</span>

<span class="sd">You can instantiate it from a dict::</span>

<span class="sd">    a = k1lib.Object.fromDict({&quot;b&quot;: 3, &quot;c&quot;: 4})</span>
<span class="sd">    print(a.c) # outputs &quot;4&quot;</span>

<span class="sd">And you can specify a default value, just like defaultdict::</span>

<span class="sd">    a = k1lib.Object().withAutoDeclare(lambda: [])</span>
<span class="sd">    a.texts.extend([&quot;factorio&quot;, &quot;world of warcraft&quot;])</span>
<span class="sd">    print(a.texts[0]) # outputs &quot;factorio&quot;</span>

<span class="sd">.. warning::</span>

<span class="sd">    Default values only work with variables that don&#39;t start with an</span>
<span class="sd">    underscore &quot;_&quot;.</span>

<span class="sd">Treating it like defaultdict is okay too::</span>

<span class="sd">    a = k1lib.Object().withAutoDeclare(lambda: [])</span>
<span class="sd">    a[&quot;movies&quot;].append(&quot;dune&quot;)</span>
<span class="sd">    print(a.movies[0]) # outputs &quot;dune&quot; &quot;&quot;&quot;</span>                                      <span class="c1"># Object</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># Object</span>
<div class="viewcode-block" id="Object.fromDict"><a class="viewcode-back" href="../../base.html#k1lib.Object.fromDict">[docs]</a>    <span class="nd">@staticmethod</span>                                                                <span class="c1"># Object</span>
    <span class="k">def</span> <span class="nf">fromDict</span><span class="p">(</span><span class="n">_dict</span><span class="p">:</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>                                          <span class="c1"># Object</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an object with attributes from a dictionary&quot;&quot;&quot;</span>                <span class="c1"># Object</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">Object</span><span class="p">();</span> <span class="n">answer</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict</span><span class="p">);</span> <span class="k">return</span> <span class="n">answer</span>          <span class="c1"># Object</span></div>
    <span class="nd">@property</span>                                                                    <span class="c1"># Object</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>                                                     <span class="c1"># Object</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Essentially ``__dict__``, but only outputs the fields you</span>
<span class="sd">defined. If your framework intentionally set some attributes, those</span>
<span class="sd">will be reported too, so beware&quot;&quot;&quot;</span>                                               <span class="c1"># Object</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">);</span> <span class="k">del</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&quot;_defaultValueGenerator&quot;</span><span class="p">]</span>       <span class="c1"># Object</span>
        <span class="k">del</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&quot;repr&quot;</span><span class="p">];</span> <span class="k">return</span> <span class="n">answer</span>                                        <span class="c1"># Object</span>
<div class="viewcode-block" id="Object.withAutoDeclare"><a class="viewcode-back" href="../../base.html#k1lib.Object.withAutoDeclare">[docs]</a>    <span class="k">def</span> <span class="nf">withAutoDeclare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaultValueGenerator</span><span class="p">):</span>                            <span class="c1"># Object</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets this Object up so that if a field doesn&#39;t</span>
<span class="sd">        exist, it will automatically create it with a</span>
<span class="sd">        default value.&quot;&quot;&quot;</span>                                                        <span class="c1"># Object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span> <span class="o">=</span> <span class="n">defaultValueGenerator</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span>         <span class="c1"># Object</span></div>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>                        <span class="c1"># Object</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>                 <span class="c1"># Object</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>                           <span class="c1"># Object</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>               <span class="c1"># Object</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>                                                 <span class="c1"># Object</span>
        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">()</span>                          <span class="c1"># Object</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;getdoc&quot;</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;This param is used internally in module `IPython.core.oinspect`, so you kinda have to set it specifically yourself instead of relying on auto declare&quot;</span><span class="p">)</span> <span class="c1"># Object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>                                  <span class="c1"># Object</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultValueGenerator</span><span class="p">()</span>                  <span class="c1"># Object</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>                                           <span class="c1"># Object</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>                                                     <span class="c1"># Object</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>                           <span class="c1"># Object</span>
<div class="viewcode-block" id="Object.withRepr"><a class="viewcode-back" href="../../base.html#k1lib.Object.withRepr">[docs]</a>    <span class="k">def</span> <span class="nf">withRepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_repr</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>                                               <span class="c1"># Object</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Specify output of ``__repr__()``. Legacy code. You can just</span>
<span class="sd">monkey patch it instead.&quot;&quot;&quot;</span>                                                      <span class="c1"># Object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repr</span> <span class="o">=</span> <span class="n">_repr</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span>                                           <span class="c1"># Object</span></div>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Object</span>
        <span class="n">_dict</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>                 <span class="c1"># Object</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, with attrs:</span><span class="se">\n</span><span class="si">{</span><span class="n">_dict</span><span class="si">}</span><span class="s2">&quot;</span>                <span class="c1"># Object</span></div>
<span class="n">ninf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">);</span> <span class="n">inf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>                                         <span class="c1"># Object</span>
<div class="viewcode-block" id="Range"><a class="viewcode-back" href="../../base.html#k1lib.Range">[docs]</a><span class="k">class</span> <span class="nc">Range</span><span class="p">:</span>                                                                     <span class="c1"># Range</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A range of numbers. It&#39;s just 2 numbers really: start and stop</span>

<span class="sd">This is essentially a convenience class to provide a nice, clean</span>
<span class="sd">abstraction and to eliminate errors. You can transform values::</span>

<span class="sd">    Range(10, 20).toUnit(13) # returns 0.3</span>
<span class="sd">    Range(10, 20).fromUnit(0.3) # returns 13</span>
<span class="sd">    Range(10, 20).toRange(Range(20, 10), 13) # returns 17</span>

<span class="sd">You can also do random math operations on it::</span>

<span class="sd">    (Range(10, 20) * 2 + 3) == Range(23, 43) # returns True</span>
<span class="sd">    Range(10, 20) == ~Range(20, 10) # returns True&quot;&quot;&quot;</span>                            <span class="c1"># Range</span>
<div class="viewcode-block" id="Range.__init__"><a class="viewcode-back" href="../../base.html#k1lib.Range.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                      <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Range.</span>

<span class="sd">There are different ``__init__`` functions for many situations:</span>

<span class="sd">- Range(2, 11.1): create range [2, 11.1]</span>
<span class="sd">- Range(15.2): creates range [0, 15.2]</span>
<span class="sd">- Range(Range(2, 3)): create range [2, 3]. This serves as sort of a catch-all</span>
<span class="sd">- Range(slice(2, 5, 2)): creates range [2, 5]. Can also be a :class:`range`</span>
<span class="sd">- Range(slice(2, -1), 10): creates range [2, 9]</span>
<span class="sd">- Range([1, 2, 7, 5]): creates range [1, 5]. Can also be a tuple</span>
<span class="sd">&quot;&quot;&quot;</span>                                                                              <span class="c1"># Range</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isNumeric</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">stop</span><span class="p">)):</span>                               <span class="c1"># Range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span>                                  <span class="c1"># Range</span>
        <span class="k">elif</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>                                  <span class="c1"># Range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">start</span>                                     <span class="c1"># Range</span>
        <span class="k">elif</span> <span class="n">stop</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">Range</span><span class="p">)):</span>          <span class="c1"># Range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">stop</span>                      <span class="c1"># Range</span>
        <span class="k">elif</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>                       <span class="c1"># Range</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">stop</span><span class="p">)[</span><span class="n">start</span><span class="p">];</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span>      <span class="c1"># Range</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>                                   <span class="c1"># Range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                          <span class="c1"># Range</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t understand </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>       <span class="c1"># Range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>                                      <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.__getitem__"><a class="viewcode-back" href="../../base.html#k1lib.Range.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>                                                <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;0 for start, 1 for stop</span>

<span class="sd">You can also pass in a :class:`slice` object, in which case, a range subset</span>
<span class="sd">will be returned. Code kinda looks like this::</span>

<span class="sd">    range(start, stop)[index]&quot;&quot;&quot;</span>                                                 <span class="c1"># Range</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>                                         <span class="c1"># Range</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>                                          <span class="c1"># Range</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">slice</span><span class="p">:</span>                                                 <span class="c1"># Range</span>
            <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>                    <span class="c1"># Range</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t get index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> of range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span> <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.fixOrder"><a class="viewcode-back" href="../../base.html#k1lib.Range.fixOrder">[docs]</a>    <span class="k">def</span> <span class="nf">fixOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Range&quot;</span><span class="p">:</span>                                               <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If start greater than stop, switch the 2, else do nothing&quot;&quot;&quot;</span>          <span class="c1"># Range</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>                                               <span class="c1"># Range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>                        <span class="c1"># Range</span>
        <span class="k">return</span> <span class="bp">self</span>                                                              <span class="c1"># Range</span></div>
    <span class="k">def</span> <span class="nf">_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]):</span>                            <span class="c1"># Range</span>
        <span class="k">if</span> <span class="n">isNumeric</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                                             <span class="c1"># Range</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>                                         <span class="c1"># Range</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>                         <span class="c1"># Range</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">Range</span><span class="p">)):</span>                                 <span class="c1"># Range</span>
            <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">stop</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">stop</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="c1"># Range</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Doesn&#39;t understand </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>                          <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">;</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>                        <span class="c1"># Range</span>
<div class="viewcode-block" id="Range.intIter"><a class="viewcode-back" href="../../base.html#k1lib.Range.intIter">[docs]</a>    <span class="k">def</span> <span class="nf">intIter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>                              <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns integers within this Range&quot;&quot;&quot;</span>                                 <span class="c1"># Range</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>                      <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.toUnit"><a class="viewcode-back" href="../../base.html#k1lib.Range.toUnit">[docs]</a>    <span class="k">def</span> <span class="nf">toUnit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>                                                         <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts x from current range to [0, 1] range. Example::</span>

<span class="sd">    r = Range(2, 10)</span>
<span class="sd">    r.toUnit(5) # will return 0.375, as that is (5-2)/(10-2)</span>

<span class="sd">You can actually pass in a lot in place of x::</span>

<span class="sd">    r = Range(0, 10)</span>
<span class="sd">    r.toUnit([5, 3, 6]) # will be [0.5, 0.3, 0.6]. Can also be a tuple</span>
<span class="sd">    r.toUnit(slice(5, 6)) # will be slice(0.5, 0.6). Can also be a range, or Range</span>

<span class="sd">.. note::</span>

<span class="sd">    In the last case, if ``start`` is None, it gets defaulted to 0, and</span>
<span class="sd">    if ``end`` is None, it gets defaulted to 1</span>
<span class="sd">&quot;&quot;&quot;</span>                                                                              <span class="c1"># Range</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>                                                                <span class="c1"># Range</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>                              <span class="c1"># Range</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span>                                 <span class="c1"># Range</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span> <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.fromUnit"><a class="viewcode-back" href="../../base.html#k1lib.Range.fromUnit">[docs]</a>    <span class="k">def</span> <span class="nf">fromUnit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>                                                       <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts x from [0, 1] range to this range. Example::</span>

<span class="sd">    r = Range(0, 10)</span>
<span class="sd">    r.fromUnit(0.3) # will return 3</span>

<span class="sd">x can be a lot of things, see :meth:`toUnit` for more&quot;&quot;&quot;</span>                         <span class="c1"># Range</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>            <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.toRange"><a class="viewcode-back" href="../../base.html#k1lib.Range.toRange">[docs]</a>    <span class="k">def</span> <span class="nf">toRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_range</span><span class="p">:</span><span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>                                        <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts x from current range to another range. Example::</span>

<span class="sd">    r = Range(0, 10)</span>
<span class="sd">    r.toRange(Range(0, 100), 6) # will return 60</span>

<span class="sd">x can be a lot of things, see :meth:`toUnit` for more.&quot;&quot;&quot;</span>                        <span class="c1"># Range</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Range</span><span class="p">(</span><span class="n">_range</span><span class="p">)</span><span class="o">.</span><span class="n">fromUnit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toUnit</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.fromRange"><a class="viewcode-back" href="../../base.html#k1lib.Range.fromRange">[docs]</a>    <span class="k">def</span> <span class="nf">fromRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_range</span><span class="p">:</span><span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>                                      <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reverse of :meth:`toRange`, effectively.&quot;&quot;&quot;</span>                           <span class="c1"># Range</span>
        <span class="k">return</span> <span class="n">_range</span><span class="o">.</span><span class="n">toRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>                                           <span class="c1"># Range</span></div>
    <span class="nd">@property</span>                                                                    <span class="c1"># Range</span>
    <span class="k">def</span> <span class="nf">range_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                            <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a :class:`range` object with start and stop values</span>
<span class="sd">rounded off&quot;&quot;&quot;</span>                                                                   <span class="c1"># Range</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="o">+</span><span class="mf">0.001</span><span class="p">))</span>  <span class="c1"># Range</span>
    <span class="nd">@property</span>                                                                    <span class="c1"># Range</span>
    <span class="k">def</span> <span class="nf">slice_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                            <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a :class:`slice` object with start and stop values</span>
<span class="sd">rounded off&quot;&quot;&quot;</span>                                                                   <span class="c1"># Range</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="mf">0.001</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="o">+</span><span class="mf">0.001</span><span class="p">))</span>  <span class="c1"># Range</span>
<div class="viewcode-block" id="Range.proportionalSlice"><a class="viewcode-back" href="../../base.html#k1lib.Range.proportionalSlice">[docs]</a>    <span class="nd">@staticmethod</span>                                                                <span class="c1"># Range</span>
    <span class="k">def</span> <span class="nf">proportionalSlice</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r1Slice</span><span class="p">:</span><span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;Range&quot;</span><span class="p">,</span> <span class="s2">&quot;Range&quot;</span><span class="p">]:</span>     <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slices r1 and r2 proportionally. Best to explain using an</span>
<span class="sd">example. Let&#39;s say you have 2 arrays created from a time-dependent</span>
<span class="sd">procedure like this::</span>

<span class="sd">    a = []; b = []</span>
<span class="sd">    for t in range(100):</span>
<span class="sd">        if t % 3 == 0: a.append(t)</span>
<span class="sd">        if t % 5 == 0: b.append(1 - t)</span>
<span class="sd">    len(a), len(b) # returns (34, 20)</span>

<span class="sd">a and b are of different lengths, but you want to plot both from 30%</span>
<span class="sd">mark to 50% mark (for a, it&#39;s elements 10 -&gt; 17, for b it&#39;s 6 -&gt; 10),</span>
<span class="sd">as they are time-dependent. As you can probably tell, to get the indicies</span>
<span class="sd">10, 17, 6, 10 is messy. So, you can do something like this instead::</span>

<span class="sd">    r1, r2 = Range.proportionalSlice(Range(len(a)), Range(len(b)), slice(10, 17))</span>

<span class="sd">This will return the Ranges [10, 17] and [5.88, 10]</span>

<span class="sd">Then, you can plot both of them side by side like this::</span>

<span class="sd">    fig, axes = plt.subplots(ncols=2)</span>
<span class="sd">    axes[0].plot(r1.range_, a[r1.slice_])</span>
<span class="sd">    axes[1].plot(r2.range_, a[r2.slice_])</span>
<span class="sd">&quot;&quot;&quot;</span>                                                                              <span class="c1"># Range</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span> <span class="n">Range</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>                                            <span class="c1"># Range</span>
        <span class="n">ar1</span> <span class="o">=</span> <span class="n">r1</span><span class="p">[</span><span class="n">r1Slice</span><span class="p">];</span> <span class="n">ar2</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">toRange</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">ar1</span><span class="p">)</span>                             <span class="c1"># Range</span>
        <span class="k">return</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span>                                                          <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.bound"><a class="viewcode-back" href="../../base.html#k1lib.Range.bound">[docs]</a>    <span class="k">def</span> <span class="nf">bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rs</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">range</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]:</span>              <span class="c1"># Range</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If input range|slice&#39;s stop and start is missing, then use this</span>
<span class="sd">range&#39;s start and stop instead.&quot;&quot;&quot;</span>                                               <span class="c1"># Range</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>                                           <span class="c1"># Range</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">stop</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>                                              <span class="c1"># Range</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">rs</span><span class="p">)(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>                                             <span class="c1"># Range</span></div>
<div class="viewcode-block" id="Range.copy"><a class="viewcode-back" href="../../base.html#k1lib.Range.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>                          <span class="c1"># Range</span></div>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]&quot;</span>                     <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_range</span><span class="p">):</span>                                                    <span class="c1"># Range</span>
        <span class="n">_range</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">_range</span><span class="p">)</span>                                                   <span class="c1"># Range</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">)</span> <span class="ow">and</span>\
            <span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_range</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">)</span>    <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>    <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>                     <span class="c1"># Range</span>
<div class="viewcode-block" id="Range.__invert__"><a class="viewcode-back" href="../../base.html#k1lib.Range.__invert__">[docs]</a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>                    <span class="c1"># Range</span></div>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">+</span> <span class="n">num</span><span class="p">)</span>      <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">num</span>                                   <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">*</span> <span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>      <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">num</span>                                   <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">return</span> <span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">num</span><span class="p">)</span>                             <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span> <span class="k">raise</span> <span class="s2">&quot;Doesn&#39;t make sense to do this!&quot;</span>          <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span>       <span class="c1"># Range</span>
    <span class="k">def</span> <span class="nf">__ceil__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span> <span class="c1"># Range</span>
    <span class="k">def</span> <span class="nf">__floor__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span> <span class="c1"># Range</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Range</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;A range of numbers: [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]. Can do:</span>
<span class="s2">- r.toUnit(x): will convert x from range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">] to [0, 1]</span>
<span class="s2">- r.fromUnit(x): will convert x from range [0, 1] to range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">]</span>
<span class="s2">- r.toRange([a, b], x): will convert x from range [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">] to range [a, b]</span>
<span class="s2">- r[0], r[1], r.start, r.stop: get start and stop values of range</span>

<span class="s2">Note: for conversion methods, you can pass in&quot;&quot;&quot;</span>                                 <span class="c1"># Range</span></div>
<span class="k">def</span> <span class="nf">yieldLowest</span><span class="p">(</span><span class="n">r1s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">],</span> <span class="n">r2s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>                       <span class="c1"># yieldLowest</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given 2 :class:`Range` generators with lengths a and b, yield every</span>
<span class="sd">object (a + b) so that :class:`Range`s with smaller start point gets yielded</span>
<span class="sd">first. Assumes that each generator:</span>

<span class="sd">- Does not intersect with itself</span>
<span class="sd">- Is sorted by start point already</span>

<span class="sd">.. warning::</span>

<span class="sd">    This method will sometimes yield the same objects given by the Iterators.</span>
<span class="sd">    Make sure you copy each :class:`Range` if your use case requires&quot;&quot;&quot;</span>          <span class="c1"># yieldLowest</span>
    <span class="n">r1s</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">r1s</span><span class="p">);</span> <span class="n">r2s</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">r2s</span><span class="p">)</span>                                             <span class="c1"># yieldLowest</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                         <span class="c1"># yieldLowest</span>
    <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield from</span> <span class="n">r2s</span><span class="p">;</span> <span class="k">return</span>                                        <span class="c1"># yieldLowest</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r2s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                         <span class="c1"># yieldLowest</span>
    <span class="k">if</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r1</span><span class="p">;</span> <span class="k">yield from</span> <span class="n">r1s</span><span class="p">;</span> <span class="k">return</span>                              <span class="c1"># yieldLowest</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                                  <span class="c1"># yieldLowest</span>
        <span class="k">while</span> <span class="n">r1</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>                                              <span class="c1"># yieldLowest</span>
            <span class="k">yield</span> <span class="n">r1</span>                                                             <span class="c1"># yieldLowest</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                 <span class="c1"># yieldLowest</span>
            <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r2</span><span class="p">;</span> <span class="k">yield from</span> <span class="n">r2s</span><span class="p">;</span> <span class="k">return</span>                      <span class="c1"># yieldLowest</span>
        <span class="k">while</span> <span class="n">r2</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">r1</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>                                              <span class="c1"># yieldLowest</span>
            <span class="k">yield</span> <span class="n">r2</span>                                                             <span class="c1"># yieldLowest</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r2s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                 <span class="c1"># yieldLowest</span>
            <span class="k">if</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r1</span><span class="p">;</span> <span class="k">yield from</span> <span class="n">r1s</span><span class="p">;</span> <span class="k">return</span>                      <span class="c1"># yieldLowest</span>
<span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">r1s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">],</span> <span class="n">r2s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>                              <span class="c1"># join</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Joins 2 :class:`Range` generators, so that overlaps gets merged</span>
<span class="sd">together.</span>

<span class="sd">.. warning::</span>

<span class="sd">    This method will sometimes yield the same objects given by the Iterators.</span>
<span class="sd">    Make sure you copy each :class:`Range` if your use case requires&quot;&quot;&quot;</span>          <span class="c1"># join</span>
    <span class="n">it</span> <span class="o">=</span> <span class="n">yieldLowest</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="n">r2s</span><span class="p">);</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                               <span class="c1"># join</span>
    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>                                                         <span class="c1"># join</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                                  <span class="c1"># join</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                      <span class="c1"># join</span>
        <span class="k">if</span> <span class="n">nr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span><span class="p">;</span> <span class="k">return</span>                                           <span class="c1"># join</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span> <span class="o">&gt;=</span> <span class="n">nr</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>                                                   <span class="c1"># join</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">nr</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>                          <span class="c1"># join</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="n">r</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">nr</span>                                                    <span class="c1"># join</span>
<span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">r1s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">],</span> <span class="n">r2s</span><span class="p">:</span><span class="n">Iterator</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>                         <span class="c1"># intersect</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Intersects 2 :class:`Range` generators, so that it only</span>
<span class="sd">returns overlaping regions&quot;&quot;&quot;</span>                                                    <span class="c1"># intersect</span>
    <span class="n">r1s</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">r1s</span><span class="p">);</span> <span class="n">r2s</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">r2s</span><span class="p">)</span>                                             <span class="c1"># intersect</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                         <span class="c1"># intersect</span>
    <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>                                                        <span class="c1"># intersect</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r2s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                         <span class="c1"># intersect</span>
    <span class="k">if</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>                                                        <span class="c1"># intersect</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                                  <span class="c1"># intersect</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># doesn&#39;t intersect at all                                      # intersect</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>                                          <span class="c1"># intersect</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>                                            <span class="c1"># intersect</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>                                          <span class="c1"># intersect</span>
            <span class="k">if</span> <span class="n">r1</span><span class="o">.</span><span class="n">stop</span> <span class="o">&gt;</span> <span class="n">r2</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span> <span class="c1"># loads next r2                                # intersect</span>
                <span class="n">r2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r2s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                             <span class="c1"># intersect</span>
                <span class="k">if</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>                                            <span class="c1"># intersect</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># loads next r1                                                # intersect</span>
                <span class="n">r1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r1s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                             <span class="c1"># intersect</span>
                <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>                                            <span class="c1"># intersect</span>
<span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="n">rs</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Range</span><span class="p">]):</span>                                                         <span class="c1"># neg</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns R - rs, where R is the set of real numbers.&quot;&quot;&quot;</span>                    <span class="c1"># neg</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                            <span class="c1"># neg</span>
    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">ninf</span><span class="p">,</span> <span class="n">inf</span><span class="p">);</span> <span class="k">return</span>                                 <span class="c1"># neg</span>
    <span class="k">if</span> <span class="n">ninf</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">ninf</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="c1"># check -inf case              # neg</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                                                  <span class="c1"># neg</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span>                                                           <span class="c1"># neg</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>                                                       <span class="c1"># neg</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>                                                            <span class="c1"># neg</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">inf</span><span class="p">:</span> <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">inf</span><span class="p">)</span>                              <span class="c1"># neg</span>
            <span class="k">return</span>                                                               <span class="c1"># neg</span>
        <span class="k">yield</span> <span class="n">Range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>                                              <span class="c1"># neg</span>
<div class="viewcode-block" id="Domain"><a class="viewcode-back" href="../../base.html#k1lib.Domain">[docs]</a><span class="k">class</span> <span class="nc">Domain</span><span class="p">:</span>                                                                    <span class="c1"># Domain</span>
<div class="viewcode-block" id="Domain.__init__"><a class="viewcode-back" href="../../base.html#k1lib.Domain.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">ranges</span><span class="p">,</span> <span class="n">dontCheck</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>                           <span class="c1"># Domain</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new domain.</span>

<span class="sd">:param ranges: each element is a :class:`Range`, although any format will be fine as this selects for that</span>
<span class="sd">:param dontCheck: don&#39;t sanitize inputs, intended to boost perf internally only</span>

<span class="sd">A domain is just an array of :class:`Range` that represents what intervals on</span>
<span class="sd">the real number line is chosen. Some examples::</span>

<span class="sd">    inf = float(&quot;inf&quot;) # shorthand for infinity</span>
<span class="sd">    Domain([5, 7.5], [2, 3]) # represents &quot;[2, 3) U [5, 7.5)&quot;</span>
<span class="sd">    Domain([2, 3.2], [3, 8]) # represents &quot;[2, 8)&quot; as overlaps are merged</span>
<span class="sd">    -Domain([2, 3]) # represents &quot;(-inf, 2) U [3, inf)&quot;, so essentially R - d, with R being the set of real numbers</span>
<span class="sd">    -Domain([-inf, 3]) # represents &quot;[3, inf)&quot;</span>
<span class="sd">    Domain.fromInts(2, 3, 6) # represents &quot;[2, 4) U [6, 7)&quot;</span>

<span class="sd">You can also do arithmetic on them, and check &quot;in&quot; oeprator::</span>

<span class="sd">    Domain([2, 3]) + Domain([4, 5]) # represents &quot;[2, 3) U [4, 5)&quot;</span>
<span class="sd">    Domain([2, 3]) + Domain([2.9, 5]) # represents &quot;[2, 5)&quot;, also merges overlaps</span>
<span class="sd">    Domain([2, 3]) &amp; Domain([2.5, 5]) # represents &quot;[2, 3) A [2.5, 5)&quot;, or &quot;[2.5, 3)&quot;</span>
<span class="sd">    3 in Domain([2, 3]) # returns False</span>
<span class="sd">    2 in Domain([2, 3]) # returns True&quot;&quot;&quot;</span>                                        <span class="c1"># Domain</span>
        <span class="k">if</span> <span class="n">dontCheck</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ranges</span><span class="p">);</span> <span class="k">return</span>                         <span class="c1"># Domain</span>
        <span class="c1"># convert all to Range type, fix its order, and sort based on .start     # Domain</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">r</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Range</span><span class="p">)</span> <span class="k">else</span> <span class="n">Range</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">fixOrder</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">]</span> <span class="c1"># Domain</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>                           <span class="c1"># Domain</span>
        <span class="c1"># merges overlapping segments                                            # Domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="p">[]))</span>                                     <span class="c1"># Domain</span></div>
<div class="viewcode-block" id="Domain.fromInts"><a class="viewcode-back" href="../../base.html#k1lib.Domain.fromInts">[docs]</a>    <span class="nd">@staticmethod</span>                                                                <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="nf">fromInts</span><span class="p">(</span><span class="o">*</span><span class="n">ints</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>                                               <span class="c1"># Domain</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a new :class:`Domain` which has ranges [i, i+1] for each</span>
<span class="sd">int given.&quot;&quot;&quot;</span>                                                                    <span class="c1"># Domain</span>
        <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">Range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ints</span><span class="p">))</span>                            <span class="c1"># Domain</span></div>
<div class="viewcode-block" id="Domain.copy"><a class="viewcode-back" href="../../base.html#k1lib.Domain.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">))</span>              <span class="c1"># Domain</span></div>
<div class="viewcode-block" id="Domain.intIter"><a class="viewcode-back" href="../../base.html#k1lib.Domain.intIter">[docs]</a>    <span class="k">def</span> <span class="nf">intIter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>                                  <span class="c1"># Domain</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yields ints in all ranges of this domain. If first range&#39;s domain</span>
<span class="sd">is :math:`(-\inf, a)`, then starts at the specified integer&quot;&quot;&quot;</span>                   <span class="c1"># Domain</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>                                         <span class="c1"># Domain</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">:</span>                                                    <span class="c1"># Domain</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="n">inf</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>                  <span class="c1"># Domain</span>
            <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span> <span class="k">yield</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">step</span>                                 <span class="c1"># Domain</span></div>
    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="n">neg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">),</span> <span class="n">dontCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>          <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">ranges</span><span class="p">)),</span> <span class="n">dontCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">domain</span><span class="p">)</span>                           <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="o">*</span><span class="n">intersect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">ranges</span><span class="p">),</span> <span class="n">dontCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">==</span> <span class="n">domain</span><span class="o">.</span><span class="n">ranges</span>                <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Domain: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>           <span class="c1"># Domain</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Domain</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>                            <span class="c1"># Domain</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Domain:</span><span class="se">\n</span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Can:</span>
<span class="s2">- 3 in d: check whether a number is in this domain or not</span>
<span class="s2">- d1 + d2: joins 2 domains</span>
<span class="s2">- -d: excludes the domain from R</span>
<span class="s2">- d1 - d2: same as d1 + (-d2)</span>
<span class="s2">- d1 &amp; d2: intersects 2 domains&quot;&quot;&quot;</span>                                               <span class="c1"># Domain</span></div>
<span class="n">puas</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">]</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="p">[[</span><span class="s2">&quot;</span><span class="se">\ue000</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\uf8ff</span><span class="s2">&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\U000f0000</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\U000ffffd</span><span class="s2">&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\U00100000</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\U0010fffd</span><span class="s2">&quot;</span><span class="p">]]]</span> <span class="c1"># Domain</span>
<div class="viewcode-block" id="AutoIncrement"><a class="viewcode-back" href="../../base.html#k1lib.AutoIncrement">[docs]</a><span class="k">class</span> <span class="nc">AutoIncrement</span><span class="p">:</span>                                                             <span class="c1"># AutoIncrement</span>
<div class="viewcode-block" id="AutoIncrement.__init__"><a class="viewcode-back" href="../../base.html#k1lib.AutoIncrement.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initialValue</span><span class="p">:</span><span class="nb">int</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="n">prefix</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># AutoIncrement</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new AutoIncrement object. Every time the object is called</span>
<span class="sd">it gets incremented by 1 automatically. Example::</span>

<span class="sd">    a = k1lib.AutoIncrement()</span>
<span class="sd">    a() # returns 0</span>
<span class="sd">    a() # returns 1</span>
<span class="sd">    a() # returns 2</span>
<span class="sd">    a.value # returns 2</span>
<span class="sd">    a.value # returns 2</span>
<span class="sd">    a() # returns 3</span>

<span class="sd">    a = AutoIncrement(n=3, prefix=&quot;cluster_&quot;)</span>
<span class="sd">    a() # returns &quot;cluster_0&quot;</span>
<span class="sd">    a() # returns &quot;cluster_1&quot;</span>
<span class="sd">    a() # returns &quot;cluster_2&quot;</span>
<span class="sd">    a() # returns &quot;cluster_0&quot;</span>

<span class="sd">:param n: if specified, then will wrap around to 0 when hit this number</span>
<span class="sd">:param prefix: if specified, will yield strings with specified prefix&quot;&quot;&quot;</span>         <span class="c1"># AutoIncrement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">initialValue</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>              <span class="c1"># AutoIncrement</span></div>
<div class="viewcode-block" id="AutoIncrement.random"><a class="viewcode-back" href="../../base.html#k1lib.AutoIncrement.random">[docs]</a>    <span class="nd">@staticmethod</span>                                                                <span class="c1"># AutoIncrement</span>
    <span class="k">def</span> <span class="nf">random</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="s2">&quot;AutoIncrement&quot;</span><span class="p">:</span>                                             <span class="c1"># AutoIncrement</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new AutoIncrement object that has a random integer initial value&quot;&quot;&quot;</span> <span class="c1"># AutoIncrement</span>
        <span class="k">return</span> <span class="n">AutoIncrement</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">))</span>                             <span class="c1"># AutoIncrement</span></div>
    <span class="nd">@property</span>                                                                    <span class="c1"># AutoIncrement</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                             <span class="c1"># AutoIncrement</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the value as-is, without auto incrementing it&quot;&quot;&quot;</span>                  <span class="c1"># AutoIncrement</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>                               <span class="c1"># AutoIncrement</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="si">}</span><span class="s2">&quot;</span>                                     <span class="c1"># AutoIncrement</span>
    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>                                                                <span class="c1"># AutoIncrement</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>                                  <span class="c1"># AutoIncrement</span>
<div class="viewcode-block" id="AutoIncrement.__call__"><a class="viewcode-back" href="../../base.html#k1lib.AutoIncrement.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># AutoIncrement</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Increments internal counter, and return it.&quot;&quot;&quot;</span>                        <span class="c1"># AutoIncrement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="mi">1</span>                                                         <span class="c1"># AutoIncrement</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span>                                <span class="c1"># AutoIncrement</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                                        <span class="c1"># AutoIncrement</span></div>
<div class="viewcode-block" id="AutoIncrement.unicode_pua"><a class="viewcode-back" href="../../base.html#k1lib.AutoIncrement.unicode_pua">[docs]</a>    <span class="nd">@staticmethod</span>                                                                <span class="c1"># AutoIncrement</span>
    <span class="k">def</span> <span class="nf">unicode_pua</span><span class="p">():</span>                                                           <span class="c1"># AutoIncrement</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a generator that generates unicode characters from within</span>
<span class="sd">unicode&#39;s private use area (PUA). Example::</span>

<span class="sd">    a = k1.AutoIncrement.unicode_pua()</span>
<span class="sd">    a | head() | deref() # returns [&#39;\ue000&#39;, &#39;\ue001&#39;, &#39;\ue002&#39;, &#39;\ue003&#39;, &#39;\ue004&#39;, &#39;\ue005&#39;, &#39;\ue006&#39;, &#39;\ue007&#39;, &#39;\ue008&#39;, &#39;\ue009&#39;]</span>
<span class="sd">&quot;&quot;&quot;</span>                                                                              <span class="c1"># AutoIncrement</span>
        <span class="k">for</span> <span class="n">pua</span> <span class="ow">in</span> <span class="n">puas</span><span class="p">:</span>                                                         <span class="c1"># AutoIncrement</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pua</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pua</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="k">yield</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>                       <span class="c1"># AutoIncrement</span></div></div>
<div class="viewcode-block" id="Wrapper"><a class="viewcode-back" href="../../base.html#k1lib.Wrapper">[docs]</a><span class="k">class</span> <span class="nc">Wrapper</span><span class="p">:</span>                                                                   <span class="c1"># Wrapper</span>
    <span class="n">value</span><span class="p">:</span><span class="n">Any</span>                                                                    <span class="c1"># Wrapper</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Internal value of this :class:`Wrapper`&quot;&quot;&quot;</span>                                <span class="c1"># Wrapper</span>
<div class="viewcode-block" id="Wrapper.__init__"><a class="viewcode-back" href="../../base.html#k1lib.Wrapper.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                              <span class="c1"># Wrapper</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a wrapper for some value and get it by calling it.</span>
<span class="sd">Example::</span>

<span class="sd">    a = k1.Wrapper(list(range(int(1e7))))</span>
<span class="sd">    # returns [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
<span class="sd">    a()[:10]</span>

<span class="sd">This exists just so that Jupyter Lab&#39;s contextual help won&#39;t automatically</span>
<span class="sd">display the (possibly humongous) value. Could be useful if you want to pass a</span>
<span class="sd">value by reference everywhere like this::</span>

<span class="sd">    o = k1.Wrapper(None)</span>
<span class="sd">    def f(obj):</span>
<span class="sd">        obj.value = 3</span>
<span class="sd">    f(o)</span>
<span class="sd">    o() # returns 3</span>

<span class="sd">You can also pipe into it like this:</span>

<span class="sd">    o = 3 | k1.Wrapper()</span>
<span class="sd">    o() # returns 3</span>
<span class="sd">&quot;&quot;&quot;</span>                                                                              <span class="c1"># Wrapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>                                                       <span class="c1"># Wrapper</span></div>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                        <span class="c1"># Wrapper</span>
<div class="viewcode-block" id="Wrapper.__ror__"><a class="viewcode-back" href="../../base.html#k1lib.Wrapper.__ror__">[docs]</a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">it</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">it</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span>                          <span class="c1"># Wrapper</span></div></div>
<div class="viewcode-block" id="Every"><a class="viewcode-back" href="../../base.html#k1lib.Every">[docs]</a><span class="k">class</span> <span class="nc">Every</span><span class="p">:</span>                                                                     <span class="c1"># Every</span>
<div class="viewcode-block" id="Every.__init__"><a class="viewcode-back" href="../../base.html#k1lib.Every.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>                                                       <span class="c1"># Every</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True every interval.</span>
<span class="sd">Example::</span>

<span class="sd">    e = k1lib.Every(4)</span>
<span class="sd">    e() # returns True</span>
<span class="sd">    e() # returns False</span>
<span class="sd">    e() # returns False</span>
<span class="sd">    e() # returns False</span>
<span class="sd">    e() # returns True&quot;&quot;&quot;</span>                                                        <span class="c1"># Every</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                                                  <span class="c1"># Every</span></div>
<div class="viewcode-block" id="Every.__call__"><a class="viewcode-back" href="../../base.html#k1lib.Every.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>                                                  <span class="c1"># Every</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True or False based on internal count.&quot;&quot;&quot;</span>                     <span class="c1"># Every</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                           <span class="c1"># Every</span></div>
    <span class="nd">@property</span>                                                                    <span class="c1"># Every</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>                                                     <span class="c1"># Every</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>                                         <span class="c1"># Every</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>                                                        <span class="c1"># Every</span></div>
<div class="viewcode-block" id="RunOnce"><a class="viewcode-back" href="../../base.html#k1lib.RunOnce">[docs]</a><span class="k">class</span> <span class="nc">RunOnce</span><span class="p">:</span>                                                                   <span class="c1"># RunOnce</span>
<div class="viewcode-block" id="RunOnce.__init__"><a class="viewcode-back" href="../../base.html#k1lib.RunOnce.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># RunOnce</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns False first time only.</span>
<span class="sd">Example::</span>

<span class="sd">    r = k1lib.RunOnce()</span>
<span class="sd">    r.done() # returns False</span>
<span class="sd">    r.done() # returns True</span>
<span class="sd">    r.done() # returns True</span>
<span class="sd">    r.revert()</span>
<span class="sd">    r.done() # returns False</span>
<span class="sd">    r.done() # returns True</span>
<span class="sd">    r.done() # returns True</span>

<span class="sd">May be useful in situations like::</span>

<span class="sd">    class A:</span>
<span class="sd">        def __init__(self):</span>
<span class="sd">            self.ro = k1lib.RunOnce()</span>
<span class="sd">        def f(self, x):</span>
<span class="sd">            if self.ro.done(): return 3 + x</span>
<span class="sd">            return 5 + x</span>
<span class="sd">    a = A()</span>
<span class="sd">    a.f(4) # returns 9</span>
<span class="sd">    a.f(4) # returns 7&quot;&quot;&quot;</span>                                                        <span class="c1"># RunOnce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>                                                       <span class="c1"># RunOnce</span></div>
<div class="viewcode-block" id="RunOnce.done"><a class="viewcode-back" href="../../base.html#k1lib.RunOnce.done">[docs]</a>    <span class="k">def</span> <span class="nf">done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                              <span class="c1"># RunOnce</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this has been called once before.&quot;&quot;&quot;</span>                          <span class="c1"># RunOnce</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                                           <span class="c1"># RunOnce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>                                                        <span class="c1"># RunOnce</span>
        <span class="k">return</span> <span class="n">v</span>                                                                 <span class="c1"># RunOnce</span></div>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># RunOnce</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias of :meth:`done`.&quot;&quot;&quot;</span>                                             <span class="c1"># RunOnce</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>                                                       <span class="c1"># RunOnce</span>
<div class="viewcode-block" id="RunOnce.revert"><a class="viewcode-back" href="../../base.html#k1lib.RunOnce.revert">[docs]</a>    <span class="k">def</span> <span class="nf">revert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                            <span class="c1"># RunOnce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>                                                       <span class="c1"># RunOnce</span></div></div>
<div class="viewcode-block" id="MaxDepth"><a class="viewcode-back" href="../../base.html#k1lib.MaxDepth">[docs]</a><span class="k">class</span> <span class="nc">MaxDepth</span><span class="p">:</span>                                                                  <span class="c1"># MaxDepth</span>
<div class="viewcode-block" id="MaxDepth.__init__"><a class="viewcode-back" href="../../base.html#k1lib.MaxDepth.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxDepth</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>                               <span class="c1"># MaxDepth</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience utility to check for graph max depth.</span>
<span class="sd">Example::</span>

<span class="sd">    def f(d):</span>
<span class="sd">        print(d.depth)</span>
<span class="sd">        if d: f(d.enter())</span>
<span class="sd">    # prints &quot;0\\n1\\n2\\n3&quot;</span>
<span class="sd">    f(k1lib.MaxDepth(3))</span>

<span class="sd">Of course, this might look unpleasant to the end user, so this is more</span>
<span class="sd">likely for internal tools.&quot;&quot;&quot;</span>                                                    <span class="c1"># MaxDepth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDepth</span> <span class="o">=</span> <span class="n">maxDepth</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>                             <span class="c1"># MaxDepth</span></div>
<div class="viewcode-block" id="MaxDepth.enter"><a class="viewcode-back" href="../../base.html#k1lib.MaxDepth.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MaxDepth&quot;</span><span class="p">:</span>                                               <span class="c1"># MaxDepth</span>
        <span class="k">return</span> <span class="n">MaxDepth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxDepth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>                           <span class="c1"># MaxDepth</span></div>
    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># MaxDepth</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxDepth</span>                                        <span class="c1"># MaxDepth</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># MaxDepth</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias of :meth:`__bool__`.&quot;&quot;&quot;</span>                                         <span class="c1"># MaxDepth</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                                                        <span class="c1"># MaxDepth</span></div>
<div class="viewcode-block" id="MovingAvg"><a class="viewcode-back" href="../../base.html#k1lib.MovingAvg">[docs]</a><span class="k">class</span> <span class="nc">MovingAvg</span><span class="p">:</span>                                                                 <span class="c1"># MovingAvg</span>
<div class="viewcode-block" id="MovingAvg.__init__"><a class="viewcode-back" href="../../base.html#k1lib.MovingAvg.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initV</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">debias</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>                  <span class="c1"># MovingAvg</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Smoothes out sequential data using momentum.</span>
<span class="sd">Example::</span>

<span class="sd">    a = k1lib.MovingAvg(5)</span>
<span class="sd">    a(3).value # returns 4.8, because 0.9*5 + 0.1*3 = 4.8</span>
<span class="sd">    a(3).value # returns 4.62</span>

<span class="sd">There&#39;s also a cli at :class:`~k1lib.cli.conv.toMovingAvg` that does the exact</span>
<span class="sd">same thing, but just more streamlined and cli-like. Both versions are kept as</span>
<span class="sd">sometimes I do want a separate object with internal state</span>

<span class="sd">Difference between normal and debias modes::</span>

<span class="sd">    x = torch.linspace(0, 10, 100); y = torch.cos(x) | op().item().all() | deref()</span>
<span class="sd">    plt.plot(x, y);</span>
<span class="sd">    a = k1lib.MovingAvg(debias=False); plt.plot(x, y | apply(lambda y: a(y).value) | deref())</span>
<span class="sd">    a = k1lib.MovingAvg(debias=True); plt.plot(x, y | apply(lambda y: a(y).value) | deref())</span>
<span class="sd">    plt.legend([&quot;Signal&quot;, &quot;Normal&quot;, &quot;Debiased&quot;])</span>

<span class="sd">.. image:: images/movingAvg.png</span>

<span class="sd">As you can see, normal mode still has the influence of the initial value at</span>
<span class="sd">0 and can&#39;t rise up fast, whereas the debias mode will ignore the initial</span>
<span class="sd">value and immediately snaps to the first saved value.</span>

<span class="sd">:param initV: initial value</span>
<span class="sd">:param alpha: number in [0, 1]. Basically how much to keep old value?</span>
<span class="sd">:param debias: whether to debias the initial value&quot;&quot;&quot;</span>                            <span class="c1"># MovingAvg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">initV</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">debias</span> <span class="o">=</span> <span class="n">debias</span>             <span class="c1"># MovingAvg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>                                          <span class="c1"># MovingAvg</span></div>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>                                                   <span class="c1"># MovingAvg</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the average with a new value&quot;&quot;&quot;</span>                               <span class="c1"># MovingAvg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>                  <span class="c1"># MovingAvg</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debias</span><span class="p">:</span>                                                          <span class="c1"># MovingAvg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>                                                          <span class="c1"># MovingAvg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>                       <span class="c1"># MovingAvg</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>                                                <span class="c1"># MovingAvg</span>
        <span class="k">return</span> <span class="bp">self</span>                                                              <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">o</span>                                  <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="n">o</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                 <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">o</span>                                  <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="n">o</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                 <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">o</span>                                  <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                                 <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">o</span>                              <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="n">o</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>                             <span class="c1"># MovingAvg</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># MovingAvg</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Moving average: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">, alpha: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span>              <span class="c1"># MovingAvg</span></div>
<span class="n">sen</span> <span class="o">=</span> <span class="s2">&quot;_ab_sentinel&quot;</span>                                                             <span class="c1"># MovingAvg</span>
<span class="n">jitOpcodes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;__len__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;len(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                                  <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__neg__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                                    <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__pos__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                                    <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__abs__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;abs(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                                  <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__invert__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(~</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                                 <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__getattr__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;getattr(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>               <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__getitem__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span><span class="p">,</span>                     <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__round__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;round(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                      <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__add__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__radd__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__sub__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rsub__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__mul__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">*</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rmul__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">*</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__matmul__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                           <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rmatmul__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                          <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__truediv__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                          <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rtruediv__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                         <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__floordiv__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">//</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                        <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rfloordiv__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">//</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                       <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__mod__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">%</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rmod__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">%</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__pow__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">**</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rpow__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">**</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                            <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__lshift__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&lt;&lt;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                          <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rlshift__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">&lt;&lt;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                         <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rshift__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&gt;&gt;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                          <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rrshift__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">&gt;&gt;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                         <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__and__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rand__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__xor__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">^</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__rxor__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">^</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                             <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__or__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                               <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__ror__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__lt__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                               <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__le__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&lt;=</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__eq__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">==</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__ne__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                              <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__gt__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>                               <span class="c1"># MovingAvg</span>
              <span class="s2">&quot;__ge__&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&gt;=</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,}</span>                             <span class="c1"># MovingAvg</span>
<span class="n">opcodeAuto</span> <span class="o">=</span> <span class="n">AutoIncrement</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_op_</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">999</span><span class="p">)</span><span class="si">}</span><span class="s2">_var_&quot;</span><span class="p">)</span>         <span class="c1"># MovingAvg</span>
<span class="n">compareOps</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;__lt__&quot;</span><span class="p">,</span> <span class="s2">&quot;__le__&quot;</span><span class="p">,</span> <span class="s2">&quot;__eq__&quot;</span><span class="p">,</span> <span class="s2">&quot;__ne__&quot;</span><span class="p">,</span> <span class="s2">&quot;__gt__&quot;</span><span class="p">,</span> <span class="s2">&quot;__ge__&quot;</span><span class="p">}</span>        <span class="c1"># MovingAvg</span>
<div class="viewcode-block" id="Absorber"><a class="viewcode-back" href="../../base.html#k1lib.Absorber">[docs]</a><span class="k">class</span> <span class="nc">Absorber</span><span class="p">:</span>                                                                  <span class="c1"># Absorber</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates an object that absorbes every operation done on it. Could be</span>
<span class="sd">useful in some scenarios::</span>

<span class="sd">    ab = k1lib.Absorber()</span>
<span class="sd">    # absorbs all operations done on the object</span>
<span class="sd">    abs(ab[::3].sum(dim=1))</span>

<span class="sd">    t = torch.randn(5, 3, 3)</span>
<span class="sd">    # returns transformed tensor of size [2, 3]</span>
<span class="sd">    ab.ab_operate(t)</span>

<span class="sd">Another::</span>

<span class="sd">    ab = Absorber()</span>
<span class="sd">    ab[2] = -50</span>
<span class="sd">    # returns [0, 1, -50, 3, 4]</span>
<span class="sd">    ab.ab_operate(list(range(5)))</span>

<span class="sd">Because this object absorbs every operation done on it, you have to be gentle with</span>
<span class="sd">it, as any unplanned disturbances might throw your code off. Best to create a new</span>
<span class="sd">one on the fly, and pass them immediately to functions, because if you&#39;re in a</span>
<span class="sd">notebook environment like Jupyter, it might poke at variables.</span>

<span class="sd">For extended code example that utilizes this, check over :class:`k1lib.cli.modifier.op`</span>
<span class="sd">source code.&quot;&quot;&quot;</span>                                                                  <span class="c1"># Absorber</span>
<div class="viewcode-block" id="Absorber.__init__"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initDict</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>                                    <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Absorber.</span>

<span class="sd">:param initDict: initial variables to set, as setattr operation is normally absorbed&quot;&quot;&quot;</span> <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_sentinel</span> <span class="o">=</span> <span class="kc">True</span>                                                 <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps</span> <span class="o">=</span> <span class="p">[]</span>                                                      <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_solidified</span> <span class="o">=</span> <span class="kc">False</span>                                              <span class="c1"># Absorber</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">initDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                        <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_sentinel</span> <span class="o">=</span> <span class="kc">False</span>                                                <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_solidify"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_solidify">[docs]</a>    <span class="k">def</span> <span class="nf">ab_solidify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                       <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use this to not absorb ``__call__`` operations anymore and makes it</span>
<span class="sd">feel like a regular function (still absorbs other operations though)::</span>

<span class="sd">    f = op()**2</span>
<span class="sd">    3 | f # returns 9, but may be you don&#39;t want to pipe it in</span>
<span class="sd">    f.op_solidify()</span>
<span class="sd">    f(3)  # returns 9&quot;&quot;&quot;</span>                                                         <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_sentinel</span> <span class="o">=</span> <span class="kc">True</span>                                                 <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_solidified</span> <span class="o">=</span> <span class="kc">True</span>                                               <span class="c1"># Absorber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ab_sentinel</span> <span class="o">=</span> <span class="kc">False</span>                                                <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span>                                                              <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_operate"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_operate">[docs]</a>    <span class="k">def</span> <span class="nf">ab_operate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>                                                     <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Special method to actually operate on an object and get the result. Not</span>
<span class="sd">absorbed. Example::</span>

<span class="sd">    # returns 6</span>
<span class="sd">    (op() * 2).ab_operate(3)&quot;&quot;&quot;</span>                                                  <span class="c1"># Absorber</span>
        <span class="k">for</span> <span class="n">desc</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                            <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="n">x</span>                                                                 <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_fastFS"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_fastFS">[docs]</a>    <span class="k">def</span> <span class="nf">ab_fastFS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>                                                  <span class="c1"># Absorber</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps</span><span class="p">;</span> <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                           <span class="c1"># Absorber</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_jsDAuto</span><span class="p">()</span>                                            <span class="c1"># Absorber</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># jit compilation                                                   # Absorber</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>                                                  <span class="c1"># Absorber</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="o">*</span><span class="n">o</span><span class="p">),</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>                                           <span class="c1"># Absorber</span>
                <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s2">&quot;__call__&quot;</span><span class="p">:</span>                                         <span class="c1"># Absorber</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="n">opcodeAuto</span><span class="p">();</span> <span class="n">vk</span> <span class="o">=</span> <span class="n">opcodeAuto</span><span class="p">()</span>                         <span class="c1"># Absorber</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">va</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">vk</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                                <span class="c1"># Absorber</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">ss</span><span class="si">}</span><span class="s2">(*</span><span class="si">{</span><span class="n">va</span><span class="si">}</span><span class="s2">, **</span><span class="si">{</span><span class="n">vk</span><span class="si">}</span><span class="s2">))&quot;</span>                                <span class="c1"># Absorber</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                                                 <span class="c1"># Absorber</span>
                    <span class="n">varname</span> <span class="o">=</span> <span class="n">opcodeAuto</span><span class="p">();</span> <span class="n">v</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                             <span class="c1"># Absorber</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>                              <span class="c1"># Absorber</span>
                        <span class="n">ss</span> <span class="o">=</span> <span class="n">jitOpcodes</span><span class="p">[</span><span class="n">opcode</span><span class="p">](</span><span class="n">ss</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                           <span class="c1"># Absorber</span>
                    <span class="k">else</span><span class="p">:</span>                                                        <span class="c1"># Absorber</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>                                      <span class="c1"># Absorber</span>
                        <span class="n">ss</span> <span class="o">=</span> <span class="n">jitOpcodes</span><span class="p">[</span><span class="n">opcode</span><span class="p">](</span><span class="n">ss</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span>                     <span class="c1"># Absorber</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">jitOpcodes</span><span class="p">[</span><span class="n">opcode</span><span class="p">](</span><span class="n">ss</span><span class="p">)</span>                                <span class="c1"># Absorber</span>
            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;lambda </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">]</span>                                 <span class="c1"># Absorber</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="k">pass</span>                                              <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_fastF"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_fastF">[docs]</a>    <span class="k">def</span> <span class="nf">ab_fastF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a function that operates on the input (just like :meth:`ab_operate`),</span>
<span class="sd">but much faster, suitable for high performance tasks. Example::</span>

<span class="sd">    f = (k1lib.Absorber() * 2).ab_fastF()</span>
<span class="sd">    # returns 6</span>
<span class="sd">    f(3)&quot;&quot;&quot;</span>                                                                      <span class="c1"># Absorber</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps</span><span class="p">;</span> <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                           <span class="c1"># Absorber</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab_fastFS</span><span class="p">()</span> <span class="c1"># jit compilation, compressing multiple steps to a single simple expression # Absorber</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span> <span class="n">fn</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span> <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;eval&quot;</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>   <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>                                            <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>                                                <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>                                                               <span class="c1"># Absorber</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>                                              <span class="c1"># Absorber</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>                                             <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>                                                               <span class="c1"># Absorber</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>                                  <span class="c1"># Absorber</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">c</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>                                          <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>                                                               <span class="c1"># Absorber</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>                      <span class="c1"># Absorber</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">d</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>                                       <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>                                                               <span class="c1"># Absorber</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>          <span class="c1"># Absorber</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">e</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">)))))</span>                                    <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab_operate</span>                                                   <span class="c1"># Absorber</span></div>
    <span class="k">def</span> <span class="nf">_ab_steps_append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>                                               <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_solidified</span><span class="p">:</span>                                              <span class="c1"># Absorber</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps</span>                                                   <span class="c1"># Absorber</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">compareOps</span> <span class="ow">and</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">compareOps</span><span class="p">:</span> <span class="c1"># Absorber</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">();</span> <span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">b</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># for 2 consecutive compare operations # Absorber</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="s2">&quot;compareOps&quot;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>              <span class="c1"># Absorber</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>                                                    <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span>                                                              <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>                                                  <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">idx</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Getting attributes starting with underscore is prohibited. If you&#39;re using `op`, consider using `aS(lambda x: x._field)` instead.&quot;</span><span class="p">)</span> <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__getattr__&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">idx</span><span class="p">)]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                 <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Only allows legit variable setting when &#39;_ab_sentinel&#39; is True. Absorbs</span>
<span class="sd">operations if it&#39;s False.&quot;&quot;&quot;</span>                                                     <span class="c1"># Absorber</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">sen</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>                                        <span class="c1"># Absorber</span>
        <span class="k">else</span><span class="p">:</span>                                                                    <span class="c1"># Absorber</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">sen</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>                          <span class="c1"># Absorber</span>
            <span class="k">else</span><span class="p">:</span>                                                                <span class="c1"># Absorber</span>
                <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span> <span class="k">return</span> <span class="n">x</span>                             <span class="c1"># Absorber</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__setattr__&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">]],</span> <span class="n">f</span><span class="p">])</span>              <span class="c1"># Absorber</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_solidified</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>                     <span class="c1"># Absorber</span>
                <span class="k">return</span> <span class="bp">self</span>                                                      <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                 <span class="c1"># Absorber</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span> <span class="k">return</span> <span class="n">x</span>                                             <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__setitem__&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">]],</span> <span class="n">f</span><span class="p">]);</span>              <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__call__&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__round__&quot;</span><span class="p">,</span>       <span class="n">ndigits</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__add__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__radd__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">+</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__sub__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">-</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rsub__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">-</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__mul__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rmul__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">*</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__matmul__&quot;</span><span class="p">,</span>    <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="nd">@o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rmatmul__&quot;</span><span class="p">,</span>   <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="nd">@x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__truediv__&quot;</span><span class="p">,</span>   <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">/</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rtruediv__&quot;</span><span class="p">,</span>  <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">/</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__floordiv__&quot;</span><span class="p">,</span>  <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">//</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rfloordiv__&quot;</span><span class="p">,</span> <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">//</span><span class="n">x</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__mod__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">%</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rmod__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">%</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__pow__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rpow__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">**</span><span class="n">x</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__lshift__&quot;</span><span class="p">,</span>    <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&lt;&lt;</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rlshift__&quot;</span><span class="p">,</span>   <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">&lt;&lt;</span><span class="n">x</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rshift__&quot;</span><span class="p">,</span>    <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rrshift__&quot;</span><span class="p">,</span>   <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">&gt;&gt;</span><span class="n">x</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__and__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&amp;</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rand__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">&amp;</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__xor__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">^</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__rxor__&quot;</span><span class="p">,</span>      <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">^</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__or__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">|</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
<div class="viewcode-block" id="Absorber.__ror__"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.__ror__">[docs]</a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__ror__&quot;</span><span class="p">,</span>       <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">o</span><span class="o">|</span><span class="n">x</span> <span class="p">]);</span> <span class="c1"># Absorber</span></div>
    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__lt__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__le__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&lt;=</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__eq__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__ne__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__gt__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&gt;</span><span class="n">o</span> <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__ge__&quot;</span><span class="p">,</span>        <span class="n">o</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&gt;=</span><span class="n">o</span><span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__neg__&quot;</span><span class="p">],</span>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span>      <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__pos__&quot;</span><span class="p">],</span>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">+</span><span class="n">x</span>      <span class="p">]);</span> <span class="c1"># Absorber</span>
    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__abs__&quot;</span><span class="p">],</span>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="p">]);</span> <span class="c1"># Absorber</span>
<div class="viewcode-block" id="Absorber.__invert__"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.__invert__">[docs]</a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__invert__&quot;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">~</span><span class="n">x</span>      <span class="p">]);</span> <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_int"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_int">[docs]</a>    <span class="k">def</span> <span class="nf">ab_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                            <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replacement for ``int(ab)``, as that requires returning an actual :class:`int`.&quot;&quot;&quot;</span> <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__int__&quot;</span><span class="p">],</span>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="p">]);</span>      <span class="c1"># Absorber</span></div>
    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">int</span><span class="p">()</span>                                      <span class="c1"># Absorber</span>
<div class="viewcode-block" id="Absorber.ab_float"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_float">[docs]</a>    <span class="k">def</span> <span class="nf">ab_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replacement for ``float(ab)``, as that requires returning an actual :class:`float`.&quot;&quot;&quot;</span> <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__float__&quot;</span><span class="p">],</span>  <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)]);</span>      <span class="c1"># Absorber</span></div>
    <span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>                                    <span class="c1"># Absorber</span>
<div class="viewcode-block" id="Absorber.ab_str"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_str">[docs]</a>    <span class="k">def</span> <span class="nf">ab_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                            <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replacement for ``str(ab)``, as that requires returning an actual :class:`str`.&quot;&quot;&quot;</span> <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__str__&quot;</span><span class="p">],</span>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="p">]);</span>      <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_len"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_len">[docs]</a>    <span class="k">def</span> <span class="nf">ab_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                            <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replacement for ``len(ab)``, as that requires returning an actual :class:`int`.&quot;&quot;&quot;</span> <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__len__&quot;</span><span class="p">],</span>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="p">]);</span>      <span class="c1"># Absorber</span></div>
<div class="viewcode-block" id="Absorber.ab_contains"><a class="viewcode-back" href="../../base.html#k1lib.Absorber.ab_contains">[docs]</a>    <span class="k">def</span> <span class="nf">ab_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>                                                  <span class="c1"># Absorber</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replacement for ``key in ab``, as that requires returning an actual :class:`int`.&quot;&quot;&quot;</span> <span class="c1"># Absorber</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ab_steps_append</span><span class="p">([[</span><span class="s2">&quot;__contains__&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]);</span> <span class="c1"># Absorber</span></div></div>
<span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\u200b</span><span class="s2">&quot;</span> <span class="c1"># weird separator, guaranteed (mostly) to not appear anywhere in the # Absorber</span>
<span class="c1"># settings, so that I can pretty print it                                        # Absorber</span>
<div class="viewcode-block" id="Settings"><a class="viewcode-back" href="../../base.html#k1lib.Settings">[docs]</a><span class="k">class</span> <span class="nc">Settings</span><span class="p">:</span>                                                                  <span class="c1"># Settings</span>
<div class="viewcode-block" id="Settings.__init__"><a class="viewcode-back" href="../../base.html#k1lib.Settings.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>                                                <span class="c1"># Settings</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new settings object. Basically fancy version of :class:`dict`.</span>
<span class="sd">Example::</span>

<span class="sd">    s = k1lib.Settings(a=3, b=&quot;42&quot;)</span>
<span class="sd">    s.c = k1lib.Settings(d=8)</span>

<span class="sd">    s.a # returns 3</span>
<span class="sd">    s.b # returns &quot;42&quot;</span>
<span class="sd">    s.c.d # returns 8</span>
<span class="sd">    print(s) # prints nested settings nicely&quot;&quot;&quot;</span>                                  <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setattr_sentinel</span> <span class="o">=</span> <span class="kc">True</span>                                            <span class="c1"># Settings</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                          <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_docs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cbs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>                                  <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setattr_sentinel</span> <span class="o">=</span> <span class="kc">False</span>                                           <span class="c1"># Settings</span></div>
<div class="viewcode-block" id="Settings.context"><a class="viewcode-back" href="../../base.html#k1lib.Settings.context">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>                                                   <span class="c1"># Settings</span>
    <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>                                                 <span class="c1"># Settings</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager to temporarily modify some settings. Applies</span>
<span class="sd">to all sub-settings. Example::</span>

<span class="sd">    s = k1lib.Settings(a=3, b=&quot;42&quot;, c=k1lib.Settings(d=8))</span>
<span class="sd">    with s.context(a=4):</span>
<span class="sd">        s.c.d = 20</span>
<span class="sd">        s.a # returns 4</span>
<span class="sd">        s.c.d # returns 20</span>
<span class="sd">    s.a # returns 3</span>
<span class="sd">    s.c.d # returns 8&quot;&quot;&quot;</span>                                                         <span class="c1"># Settings</span>
        <span class="n">oldValues</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">);</span> <span class="n">err</span> <span class="o">=</span> <span class="kc">None</span>                              <span class="c1"># Settings</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>                                                  <span class="c1"># Settings</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">oldValues</span><span class="p">:</span>                                               <span class="c1"># Settings</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; settings not found!&quot;</span><span class="p">)</span>                 <span class="c1"># Settings</span>
        <span class="k">try</span><span class="p">:</span>                                                                     <span class="c1"># Settings</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>                                <span class="c1"># Settings</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subSettings</span><span class="p">():</span>                               <span class="c1"># Settings</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">context</span><span class="p">())</span>                           <span class="c1"># Settings</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                  <span class="c1"># Settings</span>
                <span class="k">yield</span>                                                            <span class="c1"># Settings</span>
        <span class="k">finally</span><span class="p">:</span>                                                                 <span class="c1"># Settings</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">oldValues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                   <span class="c1"># Settings</span></div>
<div class="viewcode-block" id="Settings.add"><a class="viewcode-back" href="../../base.html#k1lib.Settings.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cb</span><span class="p">:</span><span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Settings&quot;</span><span class="p">:</span> <span class="c1"># Settings</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Long way to add a variable. Advantage of this is that you can slip in extra</span>
<span class="sd">documentation for the variable. Example::</span>

<span class="sd">    s = k1lib.Settings()</span>
<span class="sd">    s.add(&quot;a&quot;, 3, &quot;some docs&quot;)</span>
<span class="sd">    print(s) # displays the extra docs</span>

<span class="sd">:param cb: callback that takes in (settings, new value) if any property changes&quot;&quot;&quot;</span> <span class="c1"># Settings</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">_docs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>                                <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cbs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span>                                           <span class="c1"># Settings</span></div>
    <span class="k">def</span> <span class="nf">_docsOf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>                                                    <span class="c1"># Settings</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_docs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_docs</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>                     <span class="c1"># Settings</span>
    <span class="k">def</span> <span class="nf">_subSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Settings&quot;</span><span class="p">]]:</span>                      <span class="c1"># Settings</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Settings</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span> <span class="c1"># Settings</span>
    <span class="k">def</span> <span class="nf">_simpleSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>                          <span class="c1"># Settings</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Settings</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span> <span class="c1"># Settings</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                 <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>                                                     <span class="c1"># Settings</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;_setattr_sentinel&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setattr_sentinel</span><span class="p">:</span>              <span class="c1"># Settings</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cbs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cbs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cbs</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="c1"># Settings</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                          <span class="c1"># Settings</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;``includeDocs`` mainly used internally when generating docs in sphinx.&quot;&quot;&quot;</span> <span class="c1"># Settings</span>
        <span class="n">ks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span>             <span class="c1"># Settings</span>
        <span class="n">kSpace</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">ks</span> <span class="o">|</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())]);</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Settings:</span><span class="se">\n</span><span class="s2">&quot;</span>   <span class="c1"># Settings</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simpleSettings</span><span class="p">():</span>                                      <span class="c1"># Settings</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">kSpace</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">k1lib</span><span class="o">.</span><span class="n">limitChars</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="w"> </span><span class="n">settings</span><span class="o">.</span><span class="n">displayCutoff</span><span class="p">)</span><span class="si">}{</span><span class="n">sep</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_docsOf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="c1"># Settings</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subSettings</span><span class="p">():</span>                                         <span class="c1"># Settings</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># Settings</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">kSpace</span><span class="p">)</span><span class="si">}</span><span class="s2"> = &lt;Settings&gt;</span><span class="si">{</span><span class="n">sep</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_docsOf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">sub</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="c1"># Settings</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">op</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">|</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">pretty</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">|</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># Settings</span></div>
<span class="n">_settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;bio&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to test bioinformatics clis that involve strange command line tools like samtools and bwa&quot;</span><span class="p">))</span> <span class="c1"># Settings</span>
<span class="n">_settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;packages&quot;</span><span class="p">,</span> <span class="n">Settings</span><span class="p">(),</span> <span class="s2">&quot;which package is available to use?&quot;</span><span class="p">)</span>      <span class="c1"># Settings</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;displayCutoff&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;cutoff length when displaying a Settings object&quot;</span><span class="p">)</span> <span class="c1"># Settings</span>
<span class="n">settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;svgScale&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s2">&quot;default svg scales for clis that displays graphviz graphs&quot;</span><span class="p">)</span> <span class="c1"># Settings</span>
<span class="k">def</span> <span class="nf">_cb_wd</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>                                                                <span class="c1"># _cb_wd</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">p</span><span class="p">));</span> <span class="n">_oschdir</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>        <span class="c1"># _cb_wd</span>
    <span class="n">s</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;wd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>                                                         <span class="c1"># _cb_wd</span>
<span class="k">def</span> <span class="nf">oschdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">settings</span><span class="o">.</span><span class="n">wd</span> <span class="o">=</span> <span class="n">path</span>                                            <span class="c1"># oschdir</span>
<span class="n">_oschdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">;</span> <span class="n">os</span><span class="o">.</span><span class="n">chdir</span> <span class="o">=</span> <span class="n">oschdir</span><span class="p">;</span> <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_oschdir</span><span class="o">.</span><span class="vm">__doc__</span>     <span class="c1"># oschdir</span>
<span class="n">settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;wd&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;default working directory, will get from `os.getcwd()`. Will update using `os.chdir()` automatically when changed&quot;</span><span class="p">,</span> <span class="n">_cb_wd</span><span class="p">)</span> <span class="c1"># oschdir</span>
<span class="n">settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;cancelRun_newLine&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to add a new line character at the end of the cancel run/epoch/batch message&quot;</span><span class="p">)</span> <span class="c1"># oschdir</span>
<span class="n">or_patch</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to patch numpy arrays&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to patch Python dict keys and items&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to patch pandas series&quot;</span><span class="p">)</span>                       <span class="c1"># oschdir</span>
<span class="n">startup</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;init_ray&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to connect to ray&#39;s cluster accessible locally automatically&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;import_optionals&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;whether to try to import optional dependencies automatically or not. Set this to False if you want a faster load time, but with reduced functionalities&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;or_patch&quot;</span><span class="p">,</span> <span class="n">or_patch</span><span class="p">,</span> <span class="s2">&quot;whether to patch __or__() method for several C-extension datatypes (numpy array, pandas data frame/series, etc). This would make cli operations with them a lot more pleasant, but might cause strange bugs. Haven&#39;t met them myself though&quot;</span><span class="p">)</span> <span class="c1"># oschdir</span>
<span class="n">settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;startup&quot;</span><span class="p">,</span> <span class="n">startup</span><span class="p">,</span> <span class="s2">&quot;these settings have to be applied like this: `import k1lib; k1lib.settings.startup.or_patch = False; from k1lib.imports import *` to ensure that the values are set&quot;</span><span class="p">)</span> <span class="c1"># oschdir</span>
<span class="n">settings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pushNotificationKey&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;k1lib_pushNotificationKey&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;API key for `k1lib.pushNotification()`. See docs of that for more info&quot;</span><span class="p">)</span> <span class="c1"># oschdir</span>
<span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>                                           <span class="c1"># sign</span>
<span class="k">def</span> <span class="nf">roundOff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>                                                              <span class="c1"># roundOff</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>                                                              <span class="c1"># roundOff</span>
    <span class="k">return</span> <span class="n">m</span>                                                                     <span class="c1"># roundOff</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-7</span><span class="p">)</span> <span class="c1"># decimal place                              # roundOff</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-7</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>                       <span class="c1"># roundOff</span>
    <span class="k">return</span> <span class="n">factor</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">factor</span><span class="p">)</span>                                                <span class="c1"># roundOff</span>
<span class="k">def</span> <span class="nf">toPrecision</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">sig</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>                                                     <span class="c1"># toPrecision</span>
    <span class="k">try</span><span class="p">:</span>                                                                         <span class="c1"># toPrecision</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>                                                    <span class="c1"># toPrecision</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">num</span><span class="p">);</span> <span class="n">num</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>                                            <span class="c1"># toPrecision</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">num</span><span class="p">))</span><span class="o">+</span><span class="n">sig</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>                           <span class="c1"># toPrecision</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">*</span><span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="n">fac</span><span class="p">)</span><span class="o">/</span><span class="n">fac</span>                                              <span class="c1"># toPrecision</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">num</span>                                                           <span class="c1"># toPrecision</span>
<span class="k">def</span> <span class="nf">niceUS</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>                                                           <span class="c1"># niceUS</span>
    <span class="k">try</span><span class="p">:</span>                                                                         <span class="c1"># niceUS</span>
        <span class="k">if</span> <span class="n">std</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span> <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>                                         <span class="c1"># niceUS</span>
        <span class="n">pres</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">std</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">std</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span>               <span class="c1"># niceUS</span>
        <span class="n">std2</span> <span class="o">=</span> <span class="n">toPrecision</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">pres</span><span class="p">)</span>                                            <span class="c1"># niceUS</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">std2</span><span class="p">))</span><span class="o">+</span><span class="n">pres</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>                         <span class="c1"># niceUS</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean</span><span class="o">*</span><span class="n">fac</span><span class="p">)</span><span class="o">/</span><span class="n">fac</span><span class="p">,</span> <span class="n">std2</span>                                         <span class="c1"># niceUS</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>                                                     <span class="c1"># niceUS</span>
<span class="k">def</span> <span class="nf">removeOutliers</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>                                            <span class="c1"># removeOutliers</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">fraction</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>                                                   <span class="c1"># removeOutliers</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">b</span><span class="p">:</span><span class="o">-</span><span class="n">b</span><span class="p">]</span>                                                 <span class="c1"># removeOutliers</span>
<span class="k">def</span> <span class="nf">_US</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">UValue</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>                     <span class="c1"># _US</span>
<span class="k">if</span> <span class="n">hasTorch</span><span class="p">:</span>                                                                     <span class="c1"># _US</span>
    <span class="k">class</span> <span class="nc">UValue</span><span class="p">:</span>                                                                <span class="c1"># _US</span>
        <span class="n">_unit</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>                                        <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>                                       <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Creates a new &quot;uncertain value&quot;, which has a mean and a standard</span>
<span class="sd">deviation. You can then do math operations on them as normal, and the</span>
<span class="sd">propagation errors will be automatically calculated for you. Make sure to</span>
<span class="sd">run the calculation multiple times as the mean and std values fluctuates by</span>
<span class="sd">a little run-by-run. Example::</span>

<span class="sd">    # returns UValue(mean=4.7117, std=3.4736) object</span>
<span class="sd">    abs(k1lib.UValue() * 5 + 3)</span>

<span class="sd">You can also instantiate from an existing list/numpy array/pytorch tensor::</span>

<span class="sd">    # returns UValue(mean=24.5, std=14.58) object</span>
<span class="sd">    k1lib.UValue.fromSeries(range(50))</span>

<span class="sd">You can also do arbitrary complex math operations::</span>

<span class="sd">    # returns UValue(mean=0.5544, std=0.4871)</span>
<span class="sd">    (20 + k1lib.UValue()).f(np.sin)</span>
<span class="sd">    # same as above, but takes longer to run!</span>
<span class="sd">    (20 + k1lib.UValue()).f(math.sin)</span>

<span class="sd">I suggest you to make your arbitrary function out of numpy&#39;s operations,</span>
<span class="sd">as those are a fair bit faster than regular Python.</span>

<span class="sd">If you have a list of :class:`UValue`, and want to plot them with error</span>
<span class="sd">bars, then you can do something like this::</span>

<span class="sd">    x = np.linspace(0, 6)</span>
<span class="sd">    y = list(np.sin(x)*10) | apply(k1lib.UValue) | toList()</span>
<span class="sd">    plt.errorbar(x, *(y | transpose()));</span>

<span class="sd">There are several caveats however:</span>

<span class="sd">.. note::</span>

<span class="sd">    First is the problem of theoretically vs actually sample a</span>
<span class="sd">    distribution. Let&#39;s see an example::</span>

<span class="sd">        # returns theoretical value UValue(mean=8000.0, std=1200.0) -&gt; 8000.0  1200.0</span>
<span class="sd">        k1lib.UValue(20) ** 3</span>
<span class="sd">        # prints out actual mean and std value of (8064.1030, 1204.3529)</span>
<span class="sd">        a = k1lib.UValue(20).sample() ** 3</span>
<span class="sd">        print(a.mean(), a.std())</span>

<span class="sd">    So far so good. However, let&#39;s create some uncertainty in &quot;3&quot;::</span>

<span class="sd">        # returns theoretical value UValue(mean=8000.0, std=23996.0) -&gt; 10000.0  20000.0</span>
<span class="sd">        k1lib.UValue(20) ** k1lib.UValue(3)</span>
<span class="sd">        # prints out actual mean and std value of (815302.8750, 27068828.), but is very unstable and changes a lot</span>
<span class="sd">        a = k1lib.UValue(20).sample() ** k1lib.UValue(3).sample()</span>
<span class="sd">        print(a.mean(), a.std())</span>

<span class="sd">    Woah, what happens here? The actual mean and std values are</span>
<span class="sd">    completely different from the theoretical values. This is</span>
<span class="sd">    mainly due to UValue(3) has some outlier values large enough</span>
<span class="sd">    to boost the result up multiple times. Even removing 1% of</span>
<span class="sd">    values on either end of the spectrum does not quite work. So,</span>
<span class="sd">    becareful to interpret these uncertainty values, and in some</span>
<span class="sd">    case the theoretical estimates from math are actually very</span>
<span class="sd">    unstable and will not be observed in real life.</span>

<span class="sd">.. note::</span>

<span class="sd">    Then there&#39;s the problem of each complex operation, say ``(v*2+3)/5``</span>
<span class="sd">    will be done step by step, meaning ``a=v*2`` mean and std will be</span>
<span class="sd">    calculated first, then ignoring the calculated sample values and just</span>
<span class="sd">    go with the mean and std, sample a bunch of values from there and calculate</span>
<span class="sd">    ``a+3`` mean and std. Rinse and repeat. This means that these 2 statements</span>
<span class="sd">    may differ by a lot::</span>

<span class="sd">        # prints out (0.15867302766786406, 0.12413313456900205)</span>
<span class="sd">        x = np.linspace(-3, 3, 1000); sq = (abs(x)-0.5)**2; y = sq*np.exp(-sq)</span>
<span class="sd">        print(y.mean(), y.std())</span>

<span class="sd">        # returns UValue(mean=0.081577, std=0.32757) -&gt; 0.1  0.3</span>
<span class="sd">        x = k1lib.UValue(0, 1); sq = (abs(x)-0.5)**2; y = sq*(-sq).f(np.exp)</span>

<span class="sd">    Why this weird function? It converts from a single nice hump into multiple</span>
<span class="sd">    complex humps. Anyway, this serves to demonstrate that the result from the</span>
<span class="sd">    ``calculate -&gt; get mean, std -&gt; sample from new distribution -&gt; calculate``</span>
<span class="sd">    process might be different from just calculating from start to end and then</span>
<span class="sd">    get the mean and std.</span>

<span class="sd">.. note::</span>

<span class="sd">    Lastly, you might have problems when using the same UValue multiple times in</span>
<span class="sd">    an expression::</span>

<span class="sd">        a = UValue(10, 1)</span>
<span class="sd">        a * 2 # has mean 20, std 2</span>
<span class="sd">        a + a # has mean 20, std 1.4&quot;&quot;&quot;</span>                                          <span class="c1"># _US</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>                <span class="c1"># _US</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span> <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>                   <span class="c1"># _US</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">std</span>                                     <span class="c1"># _US</span>
        <span class="nd">@staticmethod</span>                                                            <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">_sample</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_class</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>                                <span class="c1"># _US</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_unit</span><span class="p">[</span><span class="n">_class</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>                       <span class="c1"># _US</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>                                          <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="n">std</span> <span class="o">+</span> <span class="n">mean</span>                                                <span class="c1"># _US</span>
<div class="viewcode-block" id="UValue.sample"><a class="viewcode-back" href="../../base.html#k1lib.UValue.sample">[docs]</a>        <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">_class</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>                                       <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Gets a sample :class:`np.ndarray` representative of this</span>
<span class="sd">    uncertain value. Example::</span>

<span class="sd">        # returns tensor([-5.1095,  3.3117, -2.5759,  ..., -2.5810, -1.8131,  1.8339])</span>
<span class="sd">        (k1lib.UValue() * 5).sample()&quot;&quot;&quot;</span>                                         <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_sample</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_class</span><span class="p">)</span>                              <span class="c1"># _US</span></div>
<div class="viewcode-block" id="UValue.fromSeries"><a class="viewcode-back" href="../../base.html#k1lib.UValue.fromSeries">[docs]</a>        <span class="nd">@staticmethod</span>                                                            <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">fromSeries</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>                                   <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Creates a :class:`UValue` from a bunch of numbers</span>

<span class="sd">:param series: can be a list of numbers, numpy array or PyTorch tensor</span>
<span class="sd">:param unbiased: if True, Bessels correction will be used&quot;&quot;&quot;</span>                    <span class="c1"># _US</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>                                   <span class="c1"># _US</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>                                    <span class="c1"># _US</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>                           <span class="c1"># _US</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>                              <span class="c1"># _US</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">series</span> <span class="o">*</span> <span class="mf">1.0</span>                                                <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">unbiased</span><span class="o">=</span><span class="n">unbiased</span><span class="p">))</span>          <span class="c1"># _US</span></div>
<div class="viewcode-block" id="UValue.fromBounds"><a class="viewcode-back" href="../../base.html#k1lib.UValue.fromBounds">[docs]</a>        <span class="nd">@staticmethod</span>                                                            <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">fromBounds</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">):</span>                                              <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Creates a :class:`UValue` from min and max values.</span>
<span class="sd">Example::</span>

<span class="sd">    # returns UValue(mean=2.5, std=0.5)</span>
<span class="sd">    k1lib.UValue.fromBounds(2, 3)&quot;&quot;&quot;</span>                                             <span class="c1"># _US</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_</span> <span class="o">+</span> <span class="n">max_</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>                                                <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">k1lib</span><span class="o">.</span><span class="n">UValue</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_</span><span class="o">-</span><span class="n">mid</span><span class="p">))</span>                              <span class="c1"># _US</span></div>
        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">;</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>                      <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">_niceValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">_class</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>                                       <span class="c1"># _US</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">UValue</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">UValue</span><span class="o">.</span><span class="n">_sample</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_class</span><span class="p">),</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_sample</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_class</span><span class="p">)]</span> <span class="c1"># _US</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">UValue</span><span class="o">.</span><span class="n">_sample</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_class</span><span class="p">),</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_sample</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_class</span><span class="p">)]</span> <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">_postProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>                                          <span class="c1"># _US</span>
            <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">hasNan</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c2</span><span class="o">.</span><span class="n">hasNan</span><span class="p">():</span>                                       <span class="c1"># _US</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Calculations has NaN values. They will be replaced with 0, which can affect accuracy of mean and std calculations&quot;</span><span class="p">)</span> <span class="c1"># _US</span>
                <span class="n">c1</span><span class="o">.</span><span class="n">clearNan</span><span class="p">();</span> <span class="n">c2</span><span class="o">.</span><span class="n">clearNan</span><span class="p">()</span>                                     <span class="c1"># _US</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">removeOutliers</span><span class="p">(</span><span class="n">c1</span><span class="p">);</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">removeOutliers</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>                    <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">roundOff</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">c2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span> <span class="n">roundOff</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">c2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span> <span class="c1"># _US</span>
        <span class="nd">@property</span>                                                                <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">exact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                         <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Whether this UValue is exact or not&quot;&quot;&quot;</span>                            <span class="c1"># _US</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">==</span> <span class="mi">0</span>                                                 <span class="c1"># _US</span>
        <span class="nd">@staticmethod</span>                                                            <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">_isValueExact</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>                                                    <span class="c1"># _US</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">UValue</span><span class="p">):</span> <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">exact</span>                             <span class="c1"># _US</span>
            <span class="k">try</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="k">return</span> <span class="kc">False</span>                                            <span class="c1"># _US</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>                                                  <span class="c1"># _US</span>
        <span class="nd">@staticmethod</span>                                                            <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">_value</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="c1"># gets mean value                                         # _US</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">UValue</span><span class="p">):</span> <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">mean</span>                              <span class="c1"># _US</span>
            <span class="k">try</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert a series into an exact value&quot;</span><span class="p">)</span> <span class="c1"># _US</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">v</span>                                                     <span class="c1"># _US</span>
<div class="viewcode-block" id="UValue.test"><a class="viewcode-back" href="../../base.html#k1lib.UValue.test">[docs]</a>        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                       <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns how many sigma a particular value is.&quot;&quot;&quot;</span>                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span>                                        <span class="c1"># _US</span></div>
<div class="viewcode-block" id="UValue.f"><a class="viewcode-back" href="../../base.html#k1lib.UValue.f">[docs]</a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>                                                       <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Covered in :meth:`__init__` docs&quot;&quot;&quot;</span>                               <span class="c1"># _US</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exact</span><span class="p">:</span> <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>                     <span class="c1"># _US</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">;</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_niceValue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># _US</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postProcess</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>                          <span class="c1"># _US</span>
            <span class="k">except</span><span class="p">:</span>                                                              <span class="c1"># _US</span>
                <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">[:</span><span class="mi">10000</span><span class="p">]])</span>       <span class="c1"># _US</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postProcess</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>                           <span class="c1"># _US</span></div>
<div class="viewcode-block" id="UValue.bounds"><a class="viewcode-back" href="../../base.html#k1lib.UValue.bounds">[docs]</a>        <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                        <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns (mean-std, mean+std)&quot;&quot;&quot;</span>                                   <span class="c1"># _US</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>                    <span class="c1"># _US</span></div>
        <span class="k">def</span> <span class="nf">_op2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>                                              <span class="c1"># _US</span>
            <span class="k">if</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_isValueExact</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_isValueExact</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>              <span class="c1"># _US</span>
                <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">UValue</span><span class="o">.</span><span class="n">_value</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">UValue</span><span class="o">.</span><span class="n">_value</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># _US</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">;</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_niceValue</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_niceValue</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># _US</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postProcess</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>                  <span class="c1"># _US</span>
            <span class="k">except</span><span class="p">:</span>                                                              <span class="c1"># _US</span>
                <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="mi">10000</span><span class="p">],</span> <span class="n">ys</span><span class="p">[:</span><span class="mi">10000</span><span class="p">])])</span> <span class="c1"># _US</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postProcess</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>                   <span class="c1"># _US</span>
<div class="viewcode-block" id="UValue.combine"><a class="viewcode-back" href="../../base.html#k1lib.UValue.combine">[docs]</a>        <span class="nd">@staticmethod</span>                                                            <span class="c1"># _US</span>
        <span class="k">def</span> <span class="nf">combine</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>                                      <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Combines multiple UValues into 1.</span>
<span class="sd">Example::</span>

<span class="sd">    a = k1lib.UValue(5, 1)</span>
<span class="sd">    b = k1lib.UValue(7, 1)</span>
<span class="sd">    # both returns 6.0  1.4</span>
<span class="sd">    k1lib.UValue.combine(a, b)</span>
<span class="sd">    [a, b] | k1lib.UValue.combine()</span>

<span class="sd">This will sample each UValue by default 1000 times, put them into a</span>
<span class="sd">single series and get a UValue from that. Why not just take the</span>
<span class="sd">average instead? Because the standard deviation will be less, and</span>
<span class="sd">will not actually reflect the action of combining UValues together::</span>

<span class="sd">    # returns 6.0  0.7, which is narrower than expected</span>
<span class="sd">    (a + b) / 2&quot;&quot;&quot;</span>                                                               <span class="c1"># _US</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="o">~</span><span class="n">k1lib</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">aS</span><span class="p">(</span><span class="n">UValue</span><span class="o">.</span><span class="n">combine</span><span class="p">)</span>            <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="o">.</span><span class="n">fromSeries</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]))</span> <span class="c1"># _US</span></div>
        <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                    <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>                       <span class="c1"># _US</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op2</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="c1"># representative of how this would work stochastically # _US</span>
        <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                   <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>                       <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                    <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>                       <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                   <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m2</span><span class="o">-</span><span class="n">m1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>                       <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                    <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>           <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                   <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>           <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">/</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">m2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">m2</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>   <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                               <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                                  <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m1</span><span class="o">/</span><span class="n">m2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">m2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">m2</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>   <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                    <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="n">m</span> <span class="o">=</span> <span class="n">m1</span><span class="o">**</span><span class="n">m2</span>                      <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">m2</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">m1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>                                                   <span class="c1"># _US</span>
            <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="n">m2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">_US</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> <span class="n">m</span> <span class="o">=</span> <span class="n">m1</span><span class="o">**</span><span class="n">m2</span>                      <span class="c1"># _US</span>
            <span class="k">return</span> <span class="n">UValue</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">m2</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">m1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="c1"># can&#39;t convert to pure math that makes sense # _US</span>
        <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="bp">self</span>                                       <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">niceUS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">);</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mean</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">std</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># _US</span>
        <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                      <span class="c1"># _US</span>
            <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">niceUS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">)</span>                              <span class="c1"># _US</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;UValue(mean=</span><span class="si">{</span><span class="n">toPrecision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">, std=</span><span class="si">{</span><span class="n">toPrecision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">) -&gt; </span><span class="si">{</span><span class="n">mean</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">std</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># _US</span>
<div class="viewcode-block" id="UValue.plot"><a class="viewcode-back" href="../../base.html#k1lib.UValue.plot">[docs]</a>        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                               <span class="c1"># _US</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Quickly plots a histogram of the distribution.</span>
<span class="sd">Possible to plot multiple histograms in 1 plot.&quot;&quot;&quot;</span>                               <span class="c1"># _US</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="c1"># _US</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>                                        <span class="c1"># _US</span></div>
<span class="k">else</span><span class="p">:</span>                                                                            <span class="c1"># _US</span>
<div class="viewcode-block" id="UValue"><a class="viewcode-back" href="../../base.html#k1lib.UValue">[docs]</a>    <span class="k">class</span> <span class="nc">UValue</span><span class="p">:</span>                                                                <span class="c1"># _US</span>
<div class="viewcode-block" id="UValue.__init__"><a class="viewcode-back" href="../../base.html#k1lib.UValue.__init__">[docs]</a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                      <span class="c1"># _US</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>                                                <span class="c1"># _US</span></div></div>
<span class="k">class</span> <span class="nc">ConstantPad</span><span class="p">:</span>                                                               <span class="c1"># ConstantPad</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>                                              <span class="c1"># ConstantPad</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds constant amount of padding to strings.</span>
<span class="sd">Example::</span>

<span class="sd">    p = k1.ConstantPad()</span>
<span class="sd">    p(&quot;123&quot;)    # returns &quot;123&quot;</span>
<span class="sd">    p(&quot;23&quot;)     # returns &quot; 23&quot;</span>
<span class="sd">    &quot;12345&quot; | p # returns &quot;12345&quot;, can pipe it in too, but is not strictly a cli tool</span>
<span class="sd">    p(&quot;123&quot;)    # returns &quot;  123&quot;</span>

<span class="sd">Basically, this is useful in situations when you&#39;re printing a table or status bar and</span>
<span class="sd">needs relatively constant width but you don&#39;t know what&#39;s the desired width at the start.</span>

<span class="sd">As you normally use a bunch of these in groups, there&#39;s a convenience function for</span>
<span class="sd">that too::</span>

<span class="sd">    p1, p2 = k1.ConstantPad.multi(2)</span>

<span class="sd">:param left: whether to align left or not&quot;&quot;&quot;</span>                                     <span class="c1"># ConstantPad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>                                        <span class="c1"># ConstantPad</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>                                                       <span class="c1"># ConstantPad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>                                   <span class="c1"># ConstantPad</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="k">else</span> <span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>       <span class="c1"># ConstantPad</span>
    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                <span class="c1"># ConstantPad</span>
    <span class="nd">@staticmethod</span>                                                                <span class="c1"># ConstantPad</span>
    <span class="k">def</span> <span class="nf">multi</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">ConstantPad</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="c1"># ConstantPad</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Quang Ho.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>